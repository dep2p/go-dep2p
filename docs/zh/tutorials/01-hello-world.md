# Hello Worldï¼šä¸¤èŠ‚ç‚¹äº’è¿

æœ¬æ•™ç¨‹å°†æŒ‡å¯¼ä½ å®Œæˆæœ€åŸºæœ¬çš„ DeP2P æ“ä½œï¼šè®©ä¸¤ä¸ªèŠ‚ç‚¹äº’ç›¸è¿æ¥å¹¶å‘é€æ¶ˆæ¯ã€‚

---

## æ•™ç¨‹ç›®æ ‡

å®Œæˆæœ¬æ•™ç¨‹åï¼Œä½ å°†å­¦ä¼šï¼š

- åˆ›å»ºä¸¤ä¸ª DeP2P èŠ‚ç‚¹
- ä½¿ç”¨ `known_peers` é…ç½®ç›´æ¥è¿æ¥
- å»ºç«‹è¿æ¥å¹¶å‘é€æ¶ˆæ¯
- æ¥æ”¶å¹¶å¤„ç†æ¥è‡ªå…¶ä»–èŠ‚ç‚¹çš„æ¶ˆæ¯

---

## å‰ç½®æ¡ä»¶

- Go 1.21 æˆ–æ›´é«˜ç‰ˆæœ¬
- DeP2P å·²å®‰è£…ï¼š

```bash
go get github.com/dep2p/go-dep2p
```

- ä¸¤ä¸ªç»ˆç«¯çª—å£

---

## æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æœ¬åœ°ä¸¤èŠ‚ç‚¹é€šä¿¡ç¤ºæ„å›¾                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚     èŠ‚ç‚¹ A      â”‚â—„â”€â”€â”€â”€ ç›´è¿ â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚     èŠ‚ç‚¹ B      â”‚        â”‚
â”‚  â”‚   (æ¥æ”¶æ–¹)      â”‚                    â”‚   (å‘é€æ–¹)      â”‚        â”‚
â”‚  â”‚                 â”‚                    â”‚                 â”‚        â”‚
â”‚  â”‚  å›ºå®šç«¯å£ 8001  â”‚                    â”‚  éšæœºç«¯å£       â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                     â”‚
â”‚  èŠ‚ç‚¹ B ä½¿ç”¨ known_peers é…ç½®ç›´è¿èŠ‚ç‚¹ Aï¼Œæ— éœ€ mDNS æˆ– Bootstrap    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ­¥éª¤ 1ï¼šåˆ›å»ºèŠ‚ç‚¹ Aï¼ˆæ¥æ”¶æ–¹ï¼‰

åˆ›å»ºæ–‡ä»¶ `node_a/main.go`ï¼š

```go
package main

import (
    "context"
    "fmt"
    "log"
    "os"
    "os/signal"
    "syscall"

    "github.com/dep2p/go-dep2p"
)

// å®šä¹‰åº”ç”¨åè®®
const helloProtocol = "/hello/1.0.0"

func main() {
    fmt.Println("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—")
    fmt.Println("â•‘      DeP2P Hello World - èŠ‚ç‚¹ A        â•‘")
    fmt.Println("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
    fmt.Println()

    ctx, cancel := context.WithCancel(context.Background())
    defer cancel()

    // æ•è·ä¸­æ–­ä¿¡å·
    signalCh := make(chan os.Signal, 1)
    signal.Notify(signalCh, syscall.SIGINT, syscall.SIGTERM)
    go func() {
        <-signalCh
        fmt.Println("\næ”¶åˆ°ä¸­æ–­ä¿¡å·ï¼Œå‡†å¤‡å…³é—­...")
        cancel()
    }()

    // ========================================
    // Step 1: åˆ›å»ºå¹¶å¯åŠ¨èŠ‚ç‚¹
    // ========================================
    fmt.Println("Step 1: å¯åŠ¨èŠ‚ç‚¹...")
    node, err := dep2p.New(ctx,
        dep2p.WithPreset(dep2p.PresetMinimal), // æœ€å°é…ç½®ï¼Œä¸å¯ç”¨è‡ªåŠ¨å‘ç°
        dep2p.WithListenPort(8001),            // å›ºå®šç«¯å£ï¼Œä¾¿äºèŠ‚ç‚¹ B è¿æ¥
    )
    if err != nil {
        log.Fatalf("å¯åŠ¨èŠ‚ç‚¹å¤±è´¥: %v", err)
    }
    defer node.Close()

    // å¯åŠ¨èŠ‚ç‚¹
    if err := node.Start(ctx); err != nil {
        log.Fatalf("èŠ‚ç‚¹å¯åŠ¨å¤±è´¥: %v", err)
    }

    fmt.Printf("âœ… èŠ‚ç‚¹å·²å¯åŠ¨\n")
    fmt.Printf("   èŠ‚ç‚¹ ID: %s\n", node.ID())
    fmt.Println()

    // ========================================
    // Step 2: æ³¨å†Œåè®®å¤„ç†å™¨
    // ========================================
    fmt.Println("Step 2: æ³¨å†Œåè®®å¤„ç†å™¨...")
    node.Endpoint().SetProtocolHandler(helloProtocol, func(stream dep2p.Stream) {
        defer stream.Close()

        // è¯»å–æ¶ˆæ¯
        buf := make([]byte, 1024)
        n, err := stream.Read(buf)
        if err != nil {
            fmt.Printf("è¯»å–æ¶ˆæ¯å¤±è´¥: %v\n", err)
            return
        }

        message := string(buf[:n])
        fmt.Printf("\nğŸ“¨ æ”¶åˆ°æ¶ˆæ¯: %s\n", message)
        fmt.Printf("   æ¥è‡ª: %s\n", stream.RemotePeer())

        // å‘é€å“åº”
        response := "Hello! æˆ‘æ”¶åˆ°äº†ä½ çš„æ¶ˆæ¯ï¼"
        _, err = stream.Write([]byte(response))
        if err != nil {
            fmt.Printf("å‘é€å“åº”å¤±è´¥: %v\n", err)
            return
        }
        fmt.Printf("ğŸ“¤ å·²å‘é€å“åº”: %s\n", response)
    })
    fmt.Printf("âœ… å·²æ³¨å†Œåè®®: %s\n", helloProtocol)
    fmt.Println()

    // ========================================
    // è¾“å‡ºè¿æ¥ä¿¡æ¯
    // ========================================
    addrs := node.ListenAddrs()
    fmt.Println("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
    fmt.Println("èŠ‚ç‚¹ A å·²å°±ç»ªï¼Œç­‰å¾…æ¥è‡ªèŠ‚ç‚¹ B çš„æ¶ˆæ¯...")
    fmt.Println()
    fmt.Println("è¯·åœ¨å¦ä¸€ä¸ªç»ˆç«¯å¯åŠ¨èŠ‚ç‚¹ Bï¼Œä½¿ç”¨ä»¥ä¸‹ä¿¡æ¯è¿æ¥ï¼š")
    fmt.Println()
    fmt.Printf("   èŠ‚ç‚¹ ID:  %s\n", node.ID())
    fmt.Printf("   ç›‘å¬åœ°å€: %v\n", addrs)
    fmt.Println()
    fmt.Println("èŠ‚ç‚¹ B çš„ known_peers é…ç½®ç¤ºä¾‹ï¼š")
    if len(addrs) > 0 {
        fmt.Printf("   peer_id: \"%s\"\n", node.ID())
        fmt.Printf("   addrs:   [\"%s\"]\n", addrs[0])
    }
    fmt.Println()
    fmt.Println("æŒ‰ Ctrl+C é€€å‡º")
    fmt.Println("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")

    <-ctx.Done()
    fmt.Println("èŠ‚ç‚¹ A å·²å…³é—­")
}
```

---

## æ­¥éª¤ 2ï¼šåˆ›å»ºèŠ‚ç‚¹ Bï¼ˆå‘é€æ–¹ï¼‰

åˆ›å»ºæ–‡ä»¶ `node_b/main.go`ï¼š

```go
package main

import (
    "context"
    "fmt"
    "log"
    "os"
    "time"

    "github.com/dep2p/go-dep2p"
    "github.com/dep2p/go-dep2p/config"
    "github.com/dep2p/go-dep2p/pkg/types"
)

// å®šä¹‰åº”ç”¨åè®®ï¼ˆå¿…é¡»ä¸èŠ‚ç‚¹ A ä¸€è‡´ï¼‰
const helloProtocol = "/hello/1.0.0"

func main() {
    fmt.Println("â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—")
    fmt.Println("â•‘      DeP2P Hello World - èŠ‚ç‚¹ B        â•‘")
    fmt.Println("â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
    fmt.Println()

    // ä»å‘½ä»¤è¡Œå‚æ•°è·å–èŠ‚ç‚¹ A çš„ä¿¡æ¯
    if len(os.Args) < 3 {
        fmt.Println("ç”¨æ³•: go run main.go <èŠ‚ç‚¹Açš„PeerID> <èŠ‚ç‚¹Açš„åœ°å€>")
        fmt.Println()
        fmt.Println("ç¤ºä¾‹:")
        fmt.Println("  go run main.go 12D3KooW... /ip4/127.0.0.1/udp/8001/quic-v1")
        os.Exit(1)
    }
    nodeAPeerID := os.Args[1]
    nodeAAddr := os.Args[2]

    ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second)
    defer cancel()

    // ========================================
    // Step 1: åˆ›å»ºå¹¶å¯åŠ¨èŠ‚ç‚¹ï¼ˆé…ç½® known_peersï¼‰
    // ========================================
    fmt.Println("Step 1: å¯åŠ¨èŠ‚ç‚¹ï¼ˆé…ç½® known_peers ç›´è¿ï¼‰...")

    // ä½¿ç”¨ known_peers é…ç½®ç›´æ¥è¿æ¥èŠ‚ç‚¹ A
    node, err := dep2p.New(ctx,
        dep2p.WithPreset(dep2p.PresetMinimal), // æœ€å°é…ç½®
        dep2p.WithKnownPeers(config.KnownPeer{
            PeerID: nodeAPeerID,
            Addrs:  []string{nodeAAddr},
        }),
    )
    if err != nil {
        log.Fatalf("å¯åŠ¨èŠ‚ç‚¹å¤±è´¥: %v", err)
    }
    defer node.Close()

    // å¯åŠ¨èŠ‚ç‚¹
    if err := node.Start(ctx); err != nil {
        log.Fatalf("èŠ‚ç‚¹å¯åŠ¨å¤±è´¥: %v", err)
    }

    fmt.Printf("âœ… èŠ‚ç‚¹å·²å¯åŠ¨\n")
    fmt.Printf("   èŠ‚ç‚¹ ID: %s\n", node.ID())
    fmt.Printf("   å·²é…ç½® known_peer: %s\n", nodeAPeerID[:16]+"...")
    fmt.Println()

    // ========================================
    // Step 2: ç­‰å¾…è¿æ¥å»ºç«‹
    // ========================================
    fmt.Println("Step 2: ç­‰å¾…ä¸èŠ‚ç‚¹ A å»ºç«‹è¿æ¥...")
    
    // known_peers åœ¨å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨è¿æ¥ï¼Œç­‰å¾…è¿æ¥å®Œæˆ
    time.Sleep(2 * time.Second)

    // è§£æèŠ‚ç‚¹ A çš„ ID
    nodeAID, err := types.ParseNodeID(nodeAPeerID)
    if err != nil {
        log.Fatalf("è§£æ NodeID å¤±è´¥: %v", err)
    }

    // æ£€æŸ¥è¿æ¥çŠ¶æ€
    if !node.IsConnected(nodeAID) {
        log.Fatalf("è¿æ¥èŠ‚ç‚¹ A å¤±è´¥ï¼Œè¯·æ£€æŸ¥åœ°å€å’Œé˜²ç«å¢™è®¾ç½®")
    }
    fmt.Printf("âœ… å·²è¿æ¥åˆ°èŠ‚ç‚¹ A: %s\n", nodeAID.ShortString())
    fmt.Println()

    // ========================================
    // Step 3: å‘é€æ¶ˆæ¯
    // ========================================
    fmt.Println("Step 3: å‘é€æ¶ˆæ¯...")

    // æ‰“å¼€æµ
    stream, err := node.OpenStream(ctx, nodeAID, helloProtocol)
    if err != nil {
        log.Fatalf("æ‰“å¼€æµå¤±è´¥: %v", err)
    }
    defer stream.Close()

    // å‘é€æ¶ˆæ¯
    message := "Hello, DeP2P! è¿™æ˜¯æ¥è‡ªèŠ‚ç‚¹ B çš„é—®å€™ï¼"
    _, err = stream.Write([]byte(message))
    if err != nil {
        log.Fatalf("å‘é€æ¶ˆæ¯å¤±è´¥: %v", err)
    }
    fmt.Printf("ğŸ“¤ å·²å‘é€æ¶ˆæ¯: %s\n", message)

    // è¯»å–å“åº”
    buf := make([]byte, 1024)
    n, err := stream.Read(buf)
    if err != nil {
        log.Fatalf("è¯»å–å“åº”å¤±è´¥: %v", err)
    }
    fmt.Printf("ğŸ“¨ æ”¶åˆ°å“åº”: %s\n", string(buf[:n]))
    fmt.Println()

    // ========================================
    // å®Œæˆ
    // ========================================
    fmt.Println("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
    fmt.Println("ğŸ‰ Hello World å®Œæˆï¼")
    fmt.Println("   ä½ å·²æˆåŠŸåœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚")
    fmt.Println("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•")
}
```

---

## æ­¥éª¤ 3ï¼šè¿è¡Œç¤ºä¾‹

### ç»ˆç«¯ 1ï¼šå¯åŠ¨èŠ‚ç‚¹ A

```bash
cd node_a
go run main.go
```

é¢„æœŸè¾“å‡ºï¼š

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘      DeP2P Hello World - èŠ‚ç‚¹ A        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Step 1: å¯åŠ¨èŠ‚ç‚¹...
âœ… èŠ‚ç‚¹å·²å¯åŠ¨
   èŠ‚ç‚¹ ID: 12D3KooWxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

Step 2: æ³¨å†Œåè®®å¤„ç†å™¨...
âœ… å·²æ³¨å†Œåè®®: /hello/1.0.0

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
èŠ‚ç‚¹ A å·²å°±ç»ªï¼Œç­‰å¾…æ¥è‡ªèŠ‚ç‚¹ B çš„æ¶ˆæ¯...

è¯·åœ¨å¦ä¸€ä¸ªç»ˆç«¯å¯åŠ¨èŠ‚ç‚¹ Bï¼Œä½¿ç”¨ä»¥ä¸‹ä¿¡æ¯è¿æ¥ï¼š

   èŠ‚ç‚¹ ID:  12D3KooWxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   ç›‘å¬åœ°å€: [/ip4/0.0.0.0/udp/8001/quic-v1]

èŠ‚ç‚¹ B çš„ known_peers é…ç½®ç¤ºä¾‹ï¼š
   peer_id: "12D3KooWxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
   addrs:   ["/ip4/127.0.0.1/udp/8001/quic-v1"]

æŒ‰ Ctrl+C é€€å‡º
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### ç»ˆç«¯ 2ï¼šå¯åŠ¨èŠ‚ç‚¹ B

å¤åˆ¶èŠ‚ç‚¹ A è¾“å‡ºçš„ PeerID å’Œåœ°å€ï¼Œç„¶åè¿è¡Œï¼š

```bash
cd node_b
go run main.go 12D3KooWxxx... /ip4/127.0.0.1/udp/8001/quic-v1
```

é¢„æœŸè¾“å‡ºï¼š

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘      DeP2P Hello World - èŠ‚ç‚¹ B        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Step 1: å¯åŠ¨èŠ‚ç‚¹ï¼ˆé…ç½® known_peers ç›´è¿ï¼‰...
âœ… èŠ‚ç‚¹å·²å¯åŠ¨
   èŠ‚ç‚¹ ID: 12D3KooWyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy
   å·²é…ç½® known_peer: 12D3KooWxxxxxxxx...

Step 2: ç­‰å¾…ä¸èŠ‚ç‚¹ A å»ºç«‹è¿æ¥...
âœ… å·²è¿æ¥åˆ°èŠ‚ç‚¹ A: 12D3KooWxxx...

Step 3: å‘é€æ¶ˆæ¯...
ğŸ“¤ å·²å‘é€æ¶ˆæ¯: Hello, DeP2P! è¿™æ˜¯æ¥è‡ªèŠ‚ç‚¹ B çš„é—®å€™ï¼
ğŸ“¨ æ”¶åˆ°å“åº”: Hello! æˆ‘æ”¶åˆ°äº†ä½ çš„æ¶ˆæ¯ï¼

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ‰ Hello World å®Œæˆï¼
   ä½ å·²æˆåŠŸåœ¨ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### ç»ˆç«¯ 1ï¼ˆèŠ‚ç‚¹ Aï¼‰ä¼šæ˜¾ç¤ºï¼š

```
ğŸ“¨ æ”¶åˆ°æ¶ˆæ¯: Hello, DeP2P! è¿™æ˜¯æ¥è‡ªèŠ‚ç‚¹ B çš„é—®å€™ï¼
   æ¥è‡ª: 12D3KooWyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy
ğŸ“¤ å·²å‘é€å“åº”: Hello! æˆ‘æ”¶åˆ°äº†ä½ çš„æ¶ˆæ¯ï¼
```

---

## å…³é”®æ¦‚å¿µ

### 1. known_peers ç›´è¿

```go
dep2p.WithKnownPeers(config.KnownPeer{
    PeerID: "12D3KooW...",
    Addrs:  []string{"/ip4/127.0.0.1/udp/8001/quic-v1"},
})
```

`known_peers` æ˜¯ DeP2P çš„æ ¸å¿ƒè¿æ¥æ–¹å¼ä¹‹ä¸€ï¼š

- **ä¸ä¾èµ– Bootstrap**ï¼šæ— éœ€å…¬å…±å¼•å¯¼èŠ‚ç‚¹
- **ä¸ä¾èµ– mDNS**ï¼šæ— éœ€å±€åŸŸç½‘å¹¿æ’­å‘ç°
- **å¯åŠ¨å³è¿æ¥**ï¼šèŠ‚ç‚¹å¯åŠ¨æ—¶è‡ªåŠ¨è¿æ¥é…ç½®çš„èŠ‚ç‚¹
- **é€‚ç”¨åœºæ™¯**ï¼šç§æœ‰ç½‘ç»œã€äº‘æœåŠ¡å™¨ã€å·²çŸ¥èŠ‚ç‚¹åœ°å€çš„åœºæ™¯

### 2. åè®®æ ‡è¯†ç¬¦

```go
const helloProtocol = "/hello/1.0.0"
```

åè®®æ ‡è¯†ç¬¦ç”¨äºåŒºåˆ†ä¸åŒçš„æ¶ˆæ¯ç±»å‹ï¼Œæ ¼å¼é€šå¸¸ä¸º `/åº”ç”¨å/ç‰ˆæœ¬`ã€‚ä¸¤ç«¯å¿…é¡»ä½¿ç”¨ç›¸åŒçš„åè®®æ ‡è¯†ç¬¦æ‰èƒ½é€šä¿¡ã€‚

### 3. æµå¼é€šä¿¡

```go
stream, _ := node.OpenStream(ctx, nodeAID, helloProtocol)
stream.Write([]byte("message"))
stream.Read(buf)
```

DeP2P ä½¿ç”¨æµå¼é€šä¿¡ï¼Œæ”¯æŒåŒå‘æ•°æ®ä¼ è¾“ï¼š

- **OpenStream**ï¼šä¸»åŠ¨æ‰“å¼€åˆ°ç›®æ ‡èŠ‚ç‚¹çš„æµ
- **SetProtocolHandler**ï¼šè¢«åŠ¨æ¥æ”¶æµå¹¶å¤„ç†
- **åŒå‘é€šä¿¡**ï¼šåŒä¸€ä¸ªæµå¯ä»¥åŒæ—¶è¯»å†™

### 4. Preset é¢„è®¾

```go
dep2p.WithPreset(dep2p.PresetMinimal)
```

é¢„è®¾æ˜¯é¢„å®šä¹‰çš„é…ç½®ç»„åˆï¼š

| é¢„è®¾ | è¯´æ˜ |
|------|------|
| `PresetMinimal` | æœ€å°é…ç½®ï¼Œç¦ç”¨è‡ªåŠ¨å‘ç°ï¼Œé€‚åˆæ•™ç¨‹å’Œæµ‹è¯• |
| `PresetDesktop` | æ¡Œé¢ç«¯é»˜è®¤é…ç½®ï¼Œå¯ç”¨ mDNS å’Œ Bootstrap |
| `PresetServer` | æœåŠ¡å™¨é…ç½®ï¼Œé«˜è¿æ¥æ•°é™åˆ¶ |

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šè¿æ¥å¤±è´¥

**ç—‡çŠ¶**ï¼šèŠ‚ç‚¹ B æŠ¥å‘Š `è¿æ¥èŠ‚ç‚¹ A å¤±è´¥`

**å¯èƒ½åŸå› **ï¼š
- èŠ‚ç‚¹ A çš„åœ°å€ä¸æ­£ç¡®
- é˜²ç«å¢™é˜»æ­¢ UDP æµé‡
- ç«¯å£è¢«å ç”¨

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# æ£€æŸ¥ç«¯å£æ˜¯å¦ç›‘å¬
lsof -i :8001

# æ£€æŸ¥é˜²ç«å¢™ï¼ˆmacOSï¼‰
sudo pfctl -sr | grep 8001

# ä½¿ç”¨æœ¬åœ°åœ°å€
go run main.go 12D3KooW... /ip4/127.0.0.1/udp/8001/quic-v1
```

### é—®é¢˜ 2ï¼šåè®®ä¸åŒ¹é…

**ç—‡çŠ¶**ï¼šæ¶ˆæ¯å‘é€æˆåŠŸä½†æ²¡æœ‰å“åº”

**è§£å†³æ–¹æ¡ˆ**ï¼šç¡®ä¿åè®®æ ‡è¯†ç¬¦å®Œå…¨ä¸€è‡´ï¼š

```go
// ä¸¤è¾¹å¿…é¡»ä¸€è‡´
const helloProtocol = "/hello/1.0.0"
```

### é—®é¢˜ 3ï¼šPeerID æ ¼å¼é”™è¯¯

**ç—‡çŠ¶**ï¼š`è§£æ NodeID å¤±è´¥`

**è§£å†³æ–¹æ¡ˆ**ï¼šç¡®ä¿å®Œæ•´å¤åˆ¶ PeerIDï¼Œæ ¼å¼å¦‚ `12D3KooW...`ï¼ˆä»¥ `12D3KooW` å¼€å¤´çš„ Base58 ç¼–ç ï¼‰ã€‚

---

## ä¸‹ä¸€æ­¥

- [å±€åŸŸç½‘èŠå¤©](02-local-chat.md) - ä½¿ç”¨ mDNS è‡ªåŠ¨å‘ç°æ„å»ºå¤šäººèŠå¤©
- [äº‘æœåŠ¡å™¨éƒ¨ç½²](03-cloud-deploy.md) - åœ¨å…¬ç½‘éƒ¨ç½²èŠ‚ç‚¹
- [Realm ç¾¤èŠ](04-realm-chat.md) - ä½¿ç”¨ Realm éš”ç¦»æ„å»ºç¾¤ç»„åº”ç”¨
