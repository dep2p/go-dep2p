# 版本策略详情

> 版本号规范、变更分类、兼容性承诺

---

## 元信息

| 字段 | 值 |
|------|-----|
| **状态** | approved |
| **Owner** | DeP2P Team |
| **创建日期** | 2026-01-11 |
| **更新日期** | 2026-01-11 |

---

## 1. 语义化版本

DeP2P 遵循 [Semantic Versioning 2.0.0](https://semver.org/) 规范。

### 1.1 版本号结构

```
MAJOR.MINOR.PATCH[-PRERELEASE][+BUILD]
  │     │     │        │          │
  │     │     │        │          └── 构建元数据（可选）
  │     │     │        └── 预发布标识（可选）
  │     │     └── 补丁版本：向后兼容的 Bug 修复
  │     └── 次版本：向后兼容的新功能
  └── 主版本：不兼容的 API 变更
```

### 1.2 版本示例

| 版本 | 说明 |
|------|------|
| `v0.1.0` | 初始开发版本 |
| `v1.0.0` | 首个稳定版本 |
| `v1.1.0` | 新增功能 |
| `v1.1.1` | Bug 修复 |
| `v2.0.0` | 重大变更 |
| `v2.0.0-alpha.1` | Alpha 预发布 |
| `v2.0.0-beta.1` | Beta 预发布 |
| `v2.0.0-rc.1` | 候选版本 |

---

## 2. 变更分类

### 2.1 破坏性变更 (MAJOR)

触发主版本升级的变更：

| 变更类型 | 示例 |
|----------|------|
| 删除公共 API | 移除 `Node.Dial()` 方法 |
| 修改 API 签名 | 参数类型变更 |
| 修改行为 | 默认行为改变 |
| 协议不兼容 | 协议版本升级 |
| 移除配置项 | 删除配置选项 |

### 2.2 新功能 (MINOR)

触发次版本升级的变更：

| 变更类型 | 示例 |
|----------|------|
| 新增公共 API | 添加 `Node.DialContext()` |
| 新增配置项 | 新配置选项（有默认值） |
| 新协议支持 | 支持新传输协议 |
| 功能增强 | 性能优化 |

### 2.3 Bug 修复 (PATCH)

触发补丁版本升级的变更：

| 变更类型 | 示例 |
|----------|------|
| Bug 修复 | 修复内存泄漏 |
| 安全修复 | 修复安全漏洞 |
| 文档修复 | 修正文档错误 |
| 依赖更新 | 安全依赖更新 |

---

## 3. 预发布版本

### 3.1 预发布阶段

```mermaid
flowchart LR
    Dev[开发] --> Alpha[alpha]
    Alpha --> Beta[beta]
    Beta --> RC[rc]
    RC --> Stable[稳定版]
```

| 阶段 | 稳定性 | 说明 |
|------|--------|------|
| alpha | 低 | 功能开发中，API 可能变化 |
| beta | 中 | 功能完成，API 基本稳定 |
| rc | 高 | 候选版本，除严重问题外不再变更 |

### 3.2 预发布命名

```
v{MAJOR}.{MINOR}.{PATCH}-{stage}.{n}

示例：
v2.0.0-alpha.1   # 第一个 alpha
v2.0.0-alpha.2   # 第二个 alpha
v2.0.0-beta.1    # 第一个 beta
v2.0.0-rc.1      # 第一个候选
v2.0.0-rc.2      # 第二个候选
v2.0.0           # 正式发布
```

---

## 4. 兼容性承诺

### 4.1 稳定版本 (v1.0.0+)

| 方面 | 承诺 |
|------|------|
| 公共 API | 次版本内向后兼容 |
| 配置格式 | 次版本内向后兼容 |
| 协议版本 | 次版本内向后兼容 |
| 持久化数据 | 提供迁移工具 |

### 4.2 开发版本 (v0.x.x)

| 方面 | 承诺 |
|------|------|
| 公共 API | 可能在任何版本变更 |
| 配置格式 | 可能在任何版本变更 |
| 协议版本 | 可能在任何版本变更 |

---

## 5. 版本管理

### 5.1 版本文件

```json
// version.json
{
  "version": "0.1.0",
  "git_commit": "abc1234",
  "build_time": "2026-01-11T00:00:00Z"
}
```

### 5.2 版本更新流程

1. 更新 `version.json`
2. 更新 `CHANGELOG.md`
3. 创建 Git Tag
4. 触发发布流水线

### 5.3 版本标签规范

```bash
# 正式版本
git tag -a v1.0.0 -m "Release v1.0.0"

# 预发布版本
git tag -a v2.0.0-alpha.1 -m "Release v2.0.0-alpha.1"
```

---

## 6. Go 模块版本

### 6.1 导入路径

```go
// v0.x.x 和 v1.x.x
import "github.com/dep2p/dep2p"

// v2.x.x 及以后
import "github.com/dep2p/dep2p/v2"
```

### 6.2 go.mod 版本

```
// v1.x.x
module github.com/dep2p/dep2p

// v2.x.x
module github.com/dep2p/dep2p/v2
```

---

## 7. 版本生命周期

### 7.1 支持周期

| 版本类型 | 支持周期 |
|----------|----------|
| 主版本 | 下一个主版本发布后 1 年 |
| 次版本 | 下两个次版本发布后 |
| 补丁版本 | 最新补丁发布后 |

### 7.2 版本状态

| 状态 | 说明 |
|------|------|
| Current | 当前稳定版本 |
| LTS | 长期支持版本 |
| Maintenance | 仅安全修复 |
| EOL | 生命周期结束 |

---

## 8. CHANGELOG 规范

### 8.1 格式

```markdown
# Changelog

## [Unreleased]

### Added
- 新功能

### Changed
- 变更

### Deprecated
- 废弃

### Removed
- 移除

### Fixed
- 修复

### Security
- 安全

## [1.0.0] - 2026-01-11

### Added
- 初始发布
```

### 8.2 变更类型

| 类型 | 说明 |
|------|------|
| Added | 新增功能 |
| Changed | 现有功能的变更 |
| Deprecated | 即将移除的功能 |
| Removed | 已移除的功能 |
| Fixed | Bug 修复 |
| Security | 安全相关修复 |

---

## 变更历史

| 版本 | 日期 | 作者 | 变更说明 |
|------|------|------|----------|
| v1.0 | 2026-01-11 | DeP2P Team | 初始版本 |
