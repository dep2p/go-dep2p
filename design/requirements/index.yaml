# 需求索引
# REQ-ID → 状态/测试/实现

# 版本信息
version: 1
last_updated: "2025-12"

# 元数据定义
categories:
  - conn              # 连接管理
  - address           # 地址管理
  - discovery         # 节点发现
  - bootstrap         # 引导机制
  - relay_nat         # 中继和NAT
  - security          # 安全机制
  - observability_ops # 可观测性和运维
  - protocol_stream   # 协议和流
  - resource_governance # 资源治理

audiences:
  - facade    # 面向用户的高层API（Node）
  - endpoint  # 底层端点API（Endpoint）
  - ops       # 运维和诊断

statuses:
  - planned      # 规划中
  - implemented  # 已实现
  - deprecated   # 已废弃

types:
  - generic         # 通用基础能力
  - dep2p-specific  # DeP2P个性化设计

priorities:
  - P0  # 关键路径，必须完成
  - P1  # 重要功能，应该完成
  - P2  # 可选功能，可以推迟

# =============================================================================
# 需求列表
# =============================================================================

requirements:

  # ---------------------------------------------------------------------------
  # 连接需求（conn）
  # ---------------------------------------------------------------------------
  - id: REQ-CONN-001
    title: 用户可预测的连接语义（DialBy 三语义）
    type: dep2p-specific
    priority: P0
    audience: [facade, endpoint]
    category: conn
    status: planned
    spec: REQ-CONN-001.md
    inv_refs: [INV-001, INV-002]
    api_refs:
      - file: pkg/dep2p/node.go
        symbol: Node.Connect
      - file: pkg/dep2p/node.go
        symbol: Node.ConnectToAddr
    impl_refs:
      - file: internal/core/endpoint/endpoint_impl.go
        note: 连接实现入口
    verify_tests: []
    gap: |
      - 需要实现连接语义分流
      - 需要添加测试覆盖

  # ---------------------------------------------------------------------------
  # Realm 需求（protocol_stream）
  # ---------------------------------------------------------------------------
  - id: REQ-REALM-001
    title: Realm 强制隔离（未 JoinRealm 必须拒绝）
    type: dep2p-specific
    priority: P0
    audience: [facade, endpoint]
    category: protocol_stream
    status: planned
    spec: REQ-REALM-001.md
    inv_refs: [INV-002]
    api_refs:
      - file: pkg/dep2p/node.go
        symbol: Node.JoinRealm
      - file: pkg/dep2p/node.go
        symbol: Node.LeaveRealm
      - file: pkg/dep2p/node.go
        symbol: Node.Send
      - file: pkg/dep2p/node.go
        symbol: Node.Request
    impl_refs:
      - file: internal/core/realm/realm_manager.go
        note: Realm 管理实现
    verify_tests: []
    gap: |
      - 需要实现 Realm 强制隔离
      - 需要添加 ErrNotMember 错误处理
      - 需要添加测试覆盖

# =============================================================================
# 统计信息
# =============================================================================
# 
# 总计: 2 条需求
# - P0: 2 条（planned: 2, implemented: 0）
# - P1: 0 条
# - P2: 0 条
#
# =============================================================================
