# DeP2P æ¶æ„æ€»è§ˆ

æœ¬æ–‡æ¡£æè¿° DeP2P çš„æ•´ä½“æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬ä¸‰å±‚æ¶æ„ã€å¯¹è±¡äº§å‡ºã€æœåŠ¡æ¨¡å‹å’Œåˆ†å±‚ä¸­ç»§ã€‚

---

## æ ¸å¿ƒç†å¿µ

> **è®© P2P è¿æ¥åƒè°ƒç”¨å‡½æ•°ä¸€æ ·ç®€å•ï¼šç»™ä¸€ä¸ªå…¬é’¥ï¼Œå‘ä¸ªæ¶ˆæ¯**

DeP2P é€šè¿‡ä¸‰å±‚æ¶æ„å®ç°è¿™ä¸€ç›®æ ‡ï¼š

- **Layer 1**ï¼šç³»ç»ŸåŸºç¡€å±‚ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥ï¼Œè‡ªåŠ¨å¤„ç†è¿æ¥/NAT/ä¸­ç»§
- **Layer 2**ï¼šä¸šåŠ¡éš”ç¦»å±‚ï¼Œç”¨æˆ·æ˜¾å¼åŠ å…¥ Realm
- **Layer 3**ï¼šåº”ç”¨åè®®å±‚ï¼Œç”¨æˆ·ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘

---

## æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           DeP2P ä¸‰å±‚æœåŠ¡æ¶æ„                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Layer 3: åº”ç”¨æœåŠ¡å±‚                                                        â”‚  â”‚
â”‚  â”‚                                                                           â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚  â”‚
â”‚  â”‚   â”‚  Messaging  â”‚ â”‚   PubSub    â”‚ â”‚  Discovery  â”‚ â”‚   Streams   â”‚         â”‚  â”‚
â”‚  â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚         â”‚  â”‚
â”‚  â”‚   â”‚ â€¢ Send      â”‚ â”‚ â€¢ Join      â”‚ â”‚ â€¢ FindPeers â”‚ â”‚ â€¢ Open      â”‚         â”‚  â”‚
â”‚  â”‚   â”‚ â€¢ Request   â”‚ â”‚ â€¢ Publish   â”‚ â”‚ â€¢ Advertise â”‚ â”‚ â€¢ SetHandlerâ”‚         â”‚  â”‚
â”‚  â”‚   â”‚ â€¢ OnMessage â”‚ â”‚ â€¢ Subscribe â”‚ â”‚ â€¢ Watch     â”‚ â”‚             â”‚         â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚
â”‚  â”‚                                                                           â”‚  â”‚
â”‚  â”‚   äº§å‡ºå¯¹è±¡: Topic, Subscription, Stream                                    â”‚  â”‚
â”‚  â”‚   åè®®å‰ç¼€: /dep2p/app/*                                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                        â–²                                        â”‚
â”‚                                        â”‚ realm.Messaging() / realm.PubSub()     â”‚
â”‚                                        â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Layer 2: Realm å±‚ï¼ˆä¸šåŠ¡éš”ç¦»ï¼‰                                              â”‚  â”‚
â”‚  â”‚                                                                           â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚   â”‚                            Realm                                    â”‚ â”‚  â”‚
â”‚  â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚  â”‚
â”‚  â”‚   â”‚  åŸºæœ¬ä¿¡æ¯: Name() / ID() / Members() / IsMember()                    â”‚ â”‚  â”‚
â”‚  â”‚   â”‚  æœåŠ¡å…¥å£: Messaging() / PubSub() / Discovery() / Streams()          â”‚ â”‚  â”‚
â”‚  â”‚   â”‚  ä¸­ç»§æœåŠ¡: Relay() â†’ RealmRelayService                               â”‚ â”‚  â”‚
â”‚  â”‚   â”‚  ç”Ÿå‘½å‘¨æœŸ: Leave() / Context()                                       â”‚ â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                           â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚   â”‚  Realm Relayï¼ˆä¸šåŠ¡ä¸­ç»§ï¼‰                                              â”‚ â”‚  â”‚
â”‚  â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚  â”‚
â”‚  â”‚   â”‚  â€¢ åªæœåŠ¡åŒ Realm æˆå‘˜                                                â”‚ â”‚  â”‚
â”‚  â”‚   â”‚  â€¢ éªŒè¯åŒæ–¹éƒ½æ˜¯ Realm æˆå‘˜æ‰è½¬å‘                                       â”‚ â”‚  â”‚
â”‚  â”‚   â”‚  â€¢ ç”± Realm æˆå‘˜è‡ªæ„¿æä¾›                                              â”‚ â”‚  â”‚
â”‚  â”‚   â”‚  â€¢ å…è®¸ /dep2p/app/* ä¸šåŠ¡åè®®                                         â”‚ â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                           â”‚  â”‚
â”‚  â”‚   äº§å‡ºå¯¹è±¡: Realm                                                          â”‚  â”‚
â”‚  â”‚   åè®®å‰ç¼€: /dep2p/realm/*                                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                        â–²                                        â”‚
â”‚                                        â”‚ node.JoinRealm()                       â”‚
â”‚                                        â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Layer 1: ç³»ç»ŸåŸºç¡€å±‚ï¼ˆç”¨æˆ·æ— æ„ŸçŸ¥ï¼‰                                            â”‚  â”‚
â”‚  â”‚                                                                           â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚   â”‚                            Node                                     â”‚ â”‚  â”‚
â”‚  â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚  â”‚
â”‚  â”‚   â”‚  èº«ä»½: ID() / ListenAddrs() / AdvertisedAddrs() / ShareableAddrs()   â”‚ â”‚  â”‚
â”‚  â”‚   â”‚  Realm: JoinRealm() / JoinRealmWithKey() / CurrentRealm()           â”‚ â”‚  â”‚
â”‚  â”‚   â”‚  åº•å±‚: Endpoint()                                                    â”‚ â”‚  â”‚
â”‚  â”‚   â”‚  ç”Ÿå‘½å‘¨æœŸ: Close()                                                    â”‚ â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                           â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚   â”‚  System Relayï¼ˆç³»ç»Ÿä¸­ç»§ï¼‰                                             â”‚ â”‚  â”‚
â”‚  â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚  â”‚
â”‚  â”‚   â”‚  â€¢ ç”¨äº DHT æŸ¥è¯¢ã€Bootstrapã€NAT æ¢æµ‹ã€æ‰“æ´åè°ƒ                         â”‚ â”‚  â”‚
â”‚  â”‚   â”‚  â€¢ åªå…è®¸ /dep2p/sys/* åè®®                                          â”‚ â”‚  â”‚
â”‚  â”‚   â”‚  â€¢ ä¸è½¬å‘ä¸šåŠ¡æ¶ˆæ¯ï¼ˆ/dep2p/app/*ï¼‰                                      â”‚ â”‚  â”‚
â”‚  â”‚   â”‚  â€¢ å¸¦å®½é™åˆ¶ï¼š10 KB/sï¼Œæ—¶é•¿é™åˆ¶ï¼š60 ç§’                                   â”‚ â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚                                                                           â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚  â”‚
â”‚  â”‚   â”‚  å†…éƒ¨ç»„ä»¶ï¼ˆç”¨æˆ·ä¸å¯è§ï¼‰                                           â”‚       â”‚  â”‚
â”‚  â”‚   â”‚                                                                â”‚      â”‚  â”‚
â”‚  â”‚   â”‚  Transport    Security    DHT         Relay       NAT          â”‚      â”‚  â”‚
â”‚  â”‚   â”‚  (QUIC)       (TLS)       (Kademlia)  (Circuit)   (STUN/UPnP)  â”‚      â”‚  â”‚
â”‚  â”‚   â”‚                                                                â”‚      â”‚  â”‚
â”‚  â”‚   â”‚  Bootstrap    Endpoint    ConnMgr     Identity    Addressing   â”‚      â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  â”‚
â”‚  â”‚                                                                           â”‚  â”‚
â”‚  â”‚   äº§å‡ºå¯¹è±¡: Node                                                           â”‚  â”‚
â”‚  â”‚   åè®®å‰ç¼€: /dep2p/sys/*                                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å¯¹è±¡äº§å‡ºä¸ç”Ÿå‘½å‘¨æœŸ

### å±‚æ¬¡äº§å‡ºåŸåˆ™

**æ ¸å¿ƒåŸåˆ™**ï¼šæ¯ä¸€å±‚éƒ½äº§å‡ºä¸€ä¸ªæœ‰æ„ä¹‰çš„å¯¹è±¡ï¼Œä½œä¸ºä¸‹ä¸€å±‚æ“ä½œçš„å…¥å£ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          å¯¹è±¡äº§å‡ºä¸ç”Ÿå‘½å‘¨æœŸ                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚   StartNode()                                                                   â”‚
â”‚       â”‚                                                                         â”‚
â”‚       â–¼                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”                                                                      â”‚
â”‚   â”‚ Node â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â””â”€â”€â”¬â”€â”€â”€â”˜                                                                â”‚     â”‚
â”‚      â”‚                                                                    â”‚     â”‚
â”‚      â”‚ JoinRealm()                                                        â”‚     â”‚
â”‚      â–¼                                                                    â”‚     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”                                                               â”‚     â”‚
â”‚   â”‚ Realm â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚
â”‚   â””â”€â”€â”€â”¬â”€â”€â”€â”˜                                                            â”‚  â”‚     â”‚
â”‚       â”‚                                                                â”‚  â”‚     â”‚
â”‚       â”œâ”€â”€ Messaging() â”€â”€â–¶ Messaging â”€â”€â”¬â”€â”€ OnMessage()                  â”‚  â”‚     â”‚
â”‚       â”‚                               â”œâ”€â”€ OnRequest()                  â”‚  â”‚     â”‚
â”‚       â”‚                               â”œâ”€â”€ Send()                       â”‚  â”‚     â”‚
â”‚       â”‚                               â””â”€â”€ Request()                    â”‚  â”‚     â”‚
â”‚       â”‚                                                                â”‚  â”‚     â”‚
â”‚       â”œâ”€â”€ PubSub() â”€â”€â”€â”€â”€â–¶ PubSub â”€â”€â”€â”€â”€â”¬â”€â”€ Join() â”€â”€â–¶ Topic â”€â”€â”         â”‚  â”‚     â”‚
â”‚       â”‚                               â”‚              â”‚       â”‚         â”‚  â”‚     â”‚
â”‚       â”‚                               â”‚              â”œâ”€â”€ Publish()     â”‚  â”‚     â”‚
â”‚       â”‚                               â”‚              â””â”€â”€ Subscribe()   â”‚  â”‚     â”‚
â”‚       â”‚                               â”‚                      â”‚         â”‚  â”‚     â”‚
â”‚       â”‚                               â”‚                      â–¼         â”‚  â”‚     â”‚
â”‚       â”‚                               â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚     â”‚
â”‚       â”‚                               â”‚              â”‚ Subscription â”‚  â”‚  â”‚     â”‚
â”‚       â”‚                               â”‚              â”‚  Messages()  â”‚  â”‚  â”‚     â”‚
â”‚       â”‚                               â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚     â”‚
â”‚       â”‚                               â”‚                                â”‚  â”‚     â”‚
â”‚       â”‚                               â”œâ”€â”€ Publish() (å¿«æ·)             â”‚  â”‚     â”‚
â”‚       â”‚                               â””â”€â”€ Subscribe() (å¿«æ·)           â”‚  â”‚     â”‚
â”‚       â”‚                                                                â”‚  â”‚     â”‚
â”‚       â”œâ”€â”€ Discovery() â”€â”€â–¶ RealmDiscovery â”€â”€â”¬â”€â”€ FindPeers()             â”‚  â”‚     â”‚
â”‚       â”‚                                    â”œâ”€â”€ Advertise()             â”‚  â”‚     â”‚
â”‚       â”‚                                    â””â”€â”€ Watch() â”€â”€â–¶ Events      â”‚  â”‚     â”‚
â”‚       â”‚                                                                â”‚  â”‚     â”‚
â”‚       â”œâ”€â”€ Streams() â”€â”€â”€â”€â–¶ StreamManager â”€â”€â”€â”¬â”€â”€ Open() â”€â”€â–¶ Stream       â”‚  â”‚     â”‚
â”‚       â”‚                                    â””â”€â”€ SetHandler()            â”‚  â”‚     â”‚
â”‚       â”‚                                                                â”‚  â”‚     â”‚
â”‚       â””â”€â”€ Relay() â”€â”€â”€â”€â”€â”€â–¶ RealmRelayService â”€â”¬â”€â”€ Serve()               â”‚  â”‚     â”‚
â”‚                                              â”œâ”€â”€ FindRelays()          â”‚  â”‚     â”‚
â”‚                                              â””â”€â”€ Reserve() â”€â”€â–¶ Reservation  â”‚  â”‚
â”‚                                                                        â”‚  â”‚     â”‚
â”‚   realm.Leave() â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
â”‚   node.Close()  â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¯¹è±¡äº§å‡ºè¡¨

| å±‚çº§ | æ“ä½œ | äº§å‡ºå¯¹è±¡ | è¯´æ˜ |
|------|------|---------|------|
| Layer 1 | `StartNode()` | `Node` | ä»£è¡¨æœ¬èŠ‚ç‚¹ |
| Layer 2 | `node.JoinRealm()` | `Realm` | ä»£è¡¨æ‰€åœ¨ä¸šåŠ¡ç½‘ç»œ |
| Layer 3 | `realm.Messaging()` | `Messaging` | ç‚¹å¯¹ç‚¹æ¶ˆæ¯æœåŠ¡ |
| Layer 3 | `realm.PubSub()` | `PubSub` | å‘å¸ƒè®¢é˜…æœåŠ¡ |
| Layer 3 | `realm.Discovery()` | `RealmDiscovery` | Realm å†…å‘ç°æœåŠ¡ |
| Layer 3 | `realm.Streams()` | `StreamManager` | åŸå§‹æµç®¡ç† |
| Layer 3 | `realm.Relay()` | `RealmRelayService` | Realm ä¸­ç»§æœåŠ¡ |
| Layer 3 | `pubsub.Join()` | `Topic` | å‘å¸ƒè®¢é˜…ä¸»é¢˜ |
| Layer 3 | `topic.Subscribe()` | `Subscription` | è®¢é˜…å¥æŸ„ |
| Layer 3 | `streams.Open()` | `Stream` | åŒå‘æµ |
| Layer 3 | `relay.Reserve()` | `Reservation` | ä¸­ç»§é¢„ç•™ |

---

## åˆ†å±‚ä¸­ç»§è®¾è®¡

### é—®é¢˜èƒŒæ™¯

ä¼ ç»Ÿä¸­ç»§è®¾è®¡å­˜åœ¨é—®é¢˜ï¼šé Realm æˆå‘˜çš„ä¸­ç»§èŠ‚ç‚¹ä¼šæ‰¿æ‹… Realm ä¸šåŠ¡çš„å¸¦å®½æˆæœ¬ï¼Œæ‰“ç ´ä¸šåŠ¡éš”ç¦»ã€‚

### è§£å†³æ–¹æ¡ˆï¼šä¸­ç»§ä¹Ÿè¦åˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          åˆ†å±‚ä¸­ç»§è®¾è®¡                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚  Layer 3: ä¸šåŠ¡æ¶ˆæ¯                                                         â”‚ â”‚
â”‚   â”‚           â–¼                                                               â”‚ â”‚
â”‚   â”‚  åªèµ° Realm Relay                                                          â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚  Layer 2: Realm Relayï¼ˆä¸šåŠ¡ä¸­ç»§ï¼‰                                           â”‚ â”‚
â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚   â”‚  æœåŠ¡èŒƒå›´: ä»…åŒ Realm æˆå‘˜                                                  â”‚ â”‚
â”‚   â”‚  æä¾›è€…:   Realm æˆå‘˜è‡ªæ„¿æä¾›                                                â”‚ â”‚
â”‚   â”‚  åè®®:     å…è®¸ /dep2p/app/*ã€/dep2p/realm/*                               â”‚ â”‚
â”‚   â”‚  éªŒè¯:     éªŒè¯åŒæ–¹éƒ½æ˜¯ Realm æˆå‘˜                                           â”‚ â”‚
â”‚   â”‚  é™åˆ¶:     ç”±æä¾›è€…é…ç½®                                                     â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚  Layer 1: System Relayï¼ˆç³»ç»Ÿä¸­ç»§ï¼‰                                          â”‚ â”‚
â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚
â”‚   â”‚  æœåŠ¡èŒƒå›´: å…¨ç½‘ä»»æ„èŠ‚ç‚¹                                                      â”‚ â”‚
â”‚   â”‚  æä¾›è€…:   å…¬å…±åŸºç¡€è®¾æ–½                                                      â”‚ â”‚
â”‚   â”‚  åè®®:     åªå…è®¸ /dep2p/sys/*                                              â”‚ â”‚
â”‚   â”‚  éªŒè¯:     æ— æˆå‘˜éªŒè¯                                                       â”‚ â”‚
â”‚   â”‚  é™åˆ¶:     å¸¦å®½ 10KB/sï¼Œæ—¶é•¿ 60 ç§’                                           â”‚ â”‚
â”‚   â”‚  ç”¨é€”:     DHTã€Bootstrapã€NAT æ¢æµ‹ã€æ‰“æ´åè°ƒ                                 â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¿æ¥å»ºç«‹æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                A è¿æ¥ B çš„å®Œæ•´æµç¨‹ï¼ˆA å’Œ B åœ¨åŒä¸€ Realmï¼‰                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚   Step 1: åœ°å€å‘ç°                                                               â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                             â”‚
â”‚   A é€šè¿‡ DHT æŸ¥è¯¢ B çš„åœ°å€                                                        â”‚
â”‚   B çš„ AdvertisedAddrs åŒ…å«ï¼š                                                    â”‚
â”‚     â€¢ ç›´è¿åœ°å€ï¼š/ip4/203.x.x.x/udp/4001/quic-v1                                  â”‚
â”‚     â€¢ Realm ä¸­ç»§åœ°å€ï¼š/p2p/<RealmRelay>/p2p-circuit/p2p/<B>                      â”‚
â”‚                                                                                â”‚
â”‚   Step 2: å°è¯•ç›´è¿                                                              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                            â”‚
â”‚   A ä¼˜å…ˆå°è¯•ç›´è¿ B                                                               â”‚
â”‚   âœ… æˆåŠŸ â†’ å®Œæˆ                                                                â”‚
â”‚   âŒ å¤±è´¥ â†’ Step 3                                                              â”‚
â”‚                                                                                 â”‚
â”‚   Step 3: å°è¯•æ‰“æ´                                                               â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                             â”‚
â”‚   é€šè¿‡ Layer 1 System Relay åè°ƒæ‰“æ´                                              â”‚
â”‚   System Relay åªè´Ÿè´£"åè°ƒ"ï¼Œä¸è½¬å‘ä¸šåŠ¡æ•°æ®                                         â”‚
â”‚   âœ… æˆåŠŸ â†’ å®Œæˆ                                                                 â”‚
â”‚   âŒ å¤±è´¥ â†’ Step 4                                                              â”‚
â”‚                                                                                 â”‚
â”‚   Step 4: ä½¿ç”¨ Realm Relay                                                       â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                         â”‚
â”‚   A è¯·æ±‚é€šè¿‡ Realm Relay R è¿æ¥ B                                                 â”‚
â”‚   R éªŒè¯ï¼š                                                                       â”‚
â”‚     âœ“ A æ˜¯ Realm æˆå‘˜                                                            â”‚
â”‚     âœ“ B æ˜¯ Realm æˆå‘˜                                                            â”‚
â”‚     âœ“ åè®®æ˜¯å…è®¸çš„ä¸šåŠ¡åè®®                                                         â”‚
â”‚   âœ… éªŒè¯é€šè¿‡ â†’ å»ºç«‹ä¸­ç»§è¿æ¥                                                       â”‚
â”‚   âŒ éªŒè¯å¤±è´¥ â†’ è¿æ¥å¤±è´¥                                                          â”‚
â”‚                                                                                 â”‚
â”‚   âš ï¸ æ³¨æ„ï¼š                                                                      â”‚
â”‚   â€¢ å¦‚æœ Realm å†…æ²¡æœ‰å¯ç”¨çš„ Realm Relay â†’ è¿æ¥å¤±è´¥                                  â”‚
â”‚   â€¢ ä¸ä¼š fallback åˆ° System Relay è½¬å‘ä¸šåŠ¡æ¶ˆæ¯                                     â”‚
â”‚   â€¢ è¿™ç¡®ä¿äº†ï¼šä¸šåŠ¡æ•°æ®æ°¸è¿œä¸ä¼š"æ³„éœ²"åˆ° Realm å¤–éƒ¨èŠ‚ç‚¹                                  â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## åè®® ID å‘½åè§„èŒƒï¼ˆIMPL-1227 æ›´æ–°ï¼‰

### å‰ç¼€åˆ†ç±»

| å‰ç¼€ | å±‚çº§ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| `/dep2p/sys/` | Layer 1 | ç³»ç»Ÿåè®®ï¼Œå…¨ç½‘é€šç”¨ | `/dep2p/sys/ping/1.0.0` |
| `/dep2p/realm/<realmID>/` | Layer 2 | Realm æ§åˆ¶åè®® | `/dep2p/realm/{id}/auth/1.0.0` |
| `/dep2p/app/<realmID>/` | Layer 3 | åº”ç”¨åè®®ï¼Œè‡ªåŠ¨æ·»åŠ å‰ç¼€ | `/dep2p/app/{id}/chat/1.0.0` |

### åè®®éš”ç¦»æœºåˆ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          åè®®å‘½åç©ºé—´éš”ç¦»                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚   ç”¨æˆ·ä»£ç ï¼š                                                                     â”‚
â”‚   realm.Messaging().SendWithProtocol(ctx, target, "chat/1.0.0", data)          â”‚
â”‚                                                                                 â”‚
â”‚   å®é™…åè®®ï¼š                                                                     â”‚
â”‚   /dep2p/app/<realmID>/chat/1.0.0                                              â”‚
â”‚                                                                                 â”‚
â”‚   å¥½å¤„ï¼š                                                                        â”‚
â”‚   âœ“ è‡ªåŠ¨æ¤å…¥ RealmIDï¼Œæœç»è·¨ Realm åè®®å†²çª                                       â”‚
â”‚   âœ“ ç”¨æˆ·æ— éœ€å…³å¿ƒå®Œæ•´åè®®æ ¼å¼                                                      â”‚
â”‚   âœ“ æ— æ³•ä¼ªé€ å…¶ä»– Realm çš„åè®®                                                    â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Layer 1 ç³»ç»Ÿåè®®

```
/dep2p/sys/ping/1.0.0         # å¿ƒè·³æ£€æµ‹
/dep2p/sys/identify/1.0.0     # èº«ä»½è¯†åˆ«
/dep2p/sys/dht/1.0.0          # DHT åè®®
/dep2p/sys/relay/1.0.0        # ä¸­ç»§æ§åˆ¶
/dep2p/sys/holepunch/1.0.0    # æ‰“æ´åè°ƒ
/dep2p/sys/bootstrap/1.0.0    # å¼•å¯¼åè®®
```

### Layer 2 Realm åè®®

```
/dep2p/realm/<realmID>/auth/1.0.0       # Realm è®¤è¯
/dep2p/realm/<realmID>/member/1.0.0     # æˆå‘˜ç®¡ç†
/dep2p/realm/<realmID>/sync/1.0.0       # æˆå‘˜åŒæ­¥
```

### Layer 3 åº”ç”¨åè®®

```
/dep2p/app/<realmID>/messaging/1.0.0    # æ¶ˆæ¯æœåŠ¡
/dep2p/app/<realmID>/chat/1.0.0         # ç”¨æˆ·è‡ªå®šä¹‰
/dep2p/app/<realmID>/<custom>           # æ¡†æ¶è‡ªåŠ¨æ·»åŠ å‰ç¼€
```

---

## ä½¿ç”¨ç¤ºä¾‹

```go
package main

import (
    "context"
    "fmt"
    "log"
    
    "github.com/dep2p/go-dep2p"
)

func main() {
    ctx := context.Background()
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Layer 1: å¯åŠ¨èŠ‚ç‚¹
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    node, err := dep2p.StartNode(ctx, dep2p.WithPreset(dep2p.PresetDesktop))
    if err != nil {
        log.Fatal(err)
    }
    defer node.Close()
    
    fmt.Printf("ğŸš€ èŠ‚ç‚¹ ID: %s\n", node.ID())
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Layer 2: åŠ å…¥ Realmï¼ˆä½¿ç”¨ realmKey è¿›è¡Œ PSK è®¤è¯ï¼‰
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    realmKey := dep2p.RealmKeyFromHex("your-32-byte-realm-key-hex...")
    realm, err := node.JoinRealmWithKey(ctx, "my-business-network", realmKey)
    if err != nil {
        log.Fatal(err)
    }
    defer realm.Leave()
    
    fmt.Printf("ğŸŒ å·²åŠ å…¥ Realm: %s\n", realm.Name())
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Layer 3: ä½¿ç”¨æœåŠ¡
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // æ¶ˆæ¯æœåŠ¡
    messaging := realm.Messaging()
    messaging.OnMessage(func(msg *dep2p.Message) {
        fmt.Printf("ğŸ“¨ æ”¶åˆ°æ¶ˆæ¯: %s\n", msg.Data)
    })
    
    // PubSub æœåŠ¡
    pubsub := realm.PubSub()
    topic, _ := pubsub.Join(ctx, "announcements")
    sub, _ := topic.Subscribe()
    go func() {
        for msg := range sub.Messages() {
            fmt.Printf("ğŸ“¢ å¹¿æ’­: %s\n", msg.Data)
        }
    }()
    
    // å‘ç°æœåŠ¡
    discovery := realm.Discovery()
    peers, _ := discovery.FindPeers(ctx)
    fmt.Printf("ğŸ” å‘ç° %d ä¸ªèŠ‚ç‚¹\n", len(peers))
    
    // ä¸­ç»§æœåŠ¡ï¼ˆå¯é€‰ï¼Œä½œä¸ºä¸­ç»§æä¾›è€…ï¼‰
    if hasPublicIP {
        relay := realm.Relay()
        relay.Serve(ctx, dep2p.WithRelayBandwidthLimit(10*1024*1024))
        fmt.Println("ğŸ”„ å·²æˆä¸º Realm ä¸­ç»§èŠ‚ç‚¹")
    }
    
    select {}
}
```

---

## ç›¸å…³æ–‡æ¡£

- [ä¸‰å±‚æ¶æ„è¯¦è§£](layers.md)
- [æ ¸å¿ƒç»„ä»¶](components.md)
- [ç»„ä»¶äº¤äº’](interactions.md)
- [ä¸­ç»§åè®®è§„èŒƒ](../protocols/transport/relay.md)
- [è®¨è®ºè®°å½•ï¼šAPI åˆ†å±‚è®¾è®¡](../discussions/DISC-1227-api-layer-design.md)
- [è®¨è®ºè®°å½•ï¼šåˆ†å±‚ä¸­ç»§è®¾è®¡](../discussions/DISC-1227-relay-isolation.md)
