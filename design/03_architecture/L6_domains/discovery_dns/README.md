# Discovery DNS æ¨¡å—

> **ç‰ˆæœ¬**: v1.1.0  
> **æ›´æ–°æ—¥æœŸ**: 2026-01-13  
> **å®šä½**: DNS å‘ç°ï¼ˆDiscovery Layerï¼‰

---

## æ¨¡å—æ¦‚è¿°

discovery_dns æä¾›åŸºäº DNS çš„èŠ‚ç‚¹å‘ç°èƒ½åŠ›ï¼Œæ”¯æŒ DNS-SD (DNS Service Discovery) å’Œ dnsaddr è§£æã€‚

| å±æ€§ | å€¼ |
|------|-----|
| **æ¶æ„å±‚** | Discovery Layer |
| **ä»£ç ä½ç½®** | `internal/discovery/dns/` |
| **Fx æ¨¡å—** | `fx.Module("discovery/dns")` |
| **çŠ¶æ€** | ğŸŸ¡ è§„åˆ’ä¸­ |
| **ä¾èµ–** | core_host, peerstore |

---

## æ ¸å¿ƒèŒè´£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       discovery_dns èŒè´£                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  1. dnsaddr è§£æ                                                             â”‚
â”‚     â€¢ è§£æ /dnsaddr/example.com åœ°å€                                        â”‚
â”‚     â€¢ é€’å½’è§£æåµŒå¥— dnsaddr                                                  â”‚
â”‚     â€¢ ç¼“å­˜ DNS ç»“æœ                                                         â”‚
â”‚                                                                             â”‚
â”‚  2. DNS-SD å‘ç°                                                              â”‚
â”‚     â€¢ æŸ¥è¯¢ _p2p._udp.<domain> SRV è®°å½•                                      â”‚
â”‚     â€¢ è§£æèŠ‚ç‚¹ TXT è®°å½•                                                     â”‚
â”‚                                                                             â”‚
â”‚  3. åŸŸåè§£æ                                                                 â”‚
â”‚     â€¢ /dns4/host/... è§£æä¸º /ip4/...                                        â”‚
â”‚     â€¢ /dns6/host/... è§£æä¸º /ip6/...                                        â”‚
â”‚     â€¢ /dnsaddr/host è§£æä¸ºå¤šä¸ªåœ°å€                                          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## dnsaddr æ ¼å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         dnsaddr åœ°å€æ ¼å¼                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  è¾“å…¥åœ°å€:                                                                   â”‚
â”‚    /dnsaddr/bootstrap.dep2p.io                                              â”‚
â”‚                                                                             â”‚
â”‚  DNS TXT è®°å½• (_dnsaddr.bootstrap.dep2p.io):                                â”‚
â”‚    dnsaddr=/ip4/104.131.131.82/tcp/4001/p2p/QmYwAPJzv...                   â”‚
â”‚    dnsaddr=/ip6/2604:1380::/tcp/4001/p2p/QmYwAPJzv...                      â”‚
â”‚    dnsaddr=/dnsaddr/ny5.dep2p.io                                           â”‚
â”‚                                                                             â”‚
â”‚  è§£æç»“æœ:                                                                   â”‚
â”‚    /ip4/104.131.131.82/tcp/4001/p2p/QmYwAPJzv...                           â”‚
â”‚    /ip6/2604:1380::/tcp/4001/p2p/QmYwAPJzv...                              â”‚
â”‚    (é€’å½’è§£æ ny5.dep2p.io çš„åœ°å€...)                                       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…¬å…±æ¥å£

```go
// pkg/interfaces/discovery.go (DNS éƒ¨åˆ†)

// DNSResolver DNS è§£æå™¨æ¥å£
type DNSResolver interface {
    // Resolve è§£æå¤šåœ°å€ä¸­çš„ DNS ç»„ä»¶
    Resolve(ctx context.Context, addr types.Multiaddr) ([]types.Multiaddr, error)
}

// DNSDiscovery DNS å‘ç°æ¥å£
type DNSDiscovery interface {
    Discovery
    
    // ResolveAddr è§£æ dnsaddr åœ°å€
    ResolveAddr(ctx context.Context, domain string) ([]types.PeerInfo, error)
}
```

---

## ä½¿ç”¨åœºæ™¯

### å¼•å¯¼èŠ‚ç‚¹é…ç½®

```go
// ä½¿ç”¨ dnsaddr é…ç½®å¼•å¯¼èŠ‚ç‚¹
bootstrapAddrs := []string{
    "/dnsaddr/bootstrap.dep2p.io",
    "/dnsaddr/bootstrap.libp2p.io",
}

// dnsaddr è‡ªåŠ¨è§£æä¸ºå®é™…åœ°å€
node, _ := dep2p.New(
    dep2p.WithBootstrap(bootstrapAddrs...),
)
```

### åŠ¨æ€èŠ‚ç‚¹å‘ç°

```
ä¼˜åŠ¿:
â€¢ è¿è¥å•†å¯åŠ¨æ€æ›´æ–°å¼•å¯¼èŠ‚ç‚¹
â€¢ æ— éœ€æ›´æ–°å®¢æˆ·ç«¯ä»£ç 
â€¢ æ”¯æŒ CDN å’Œè´Ÿè½½å‡è¡¡
â€¢ åœ°ç†ä½ç½®æ™ºèƒ½è·¯ç”±
```

---

## DNS è®°å½•ç¤ºä¾‹

```
; _dnsaddr.bootstrap.dep2p.io TXT è®°å½•
_dnsaddr.bootstrap.dep2p.io.  300  IN  TXT  "dnsaddr=/ip4/147.75.69.143/tcp/4001/p2p/QmcZf59..."
_dnsaddr.bootstrap.dep2p.io.  300  IN  TXT  "dnsaddr=/ip4/147.75.83.83/tcp/4001/p2p/QmbLHAnM..."
_dnsaddr.bootstrap.dep2p.io.  300  IN  TXT  "dnsaddr=/dnsaddr/sg1.bootstrap.dep2p.io"

; _dnsaddr.sg1.bootstrap.dep2p.io TXT è®°å½•
_dnsaddr.sg1.bootstrap.dep2p.io.  300  IN  TXT  "dnsaddr=/ip4/139.178.91.71/tcp/4001/p2p/QmNnooDu..."
```

---

## å‚è€ƒå®ç°

### go-multiaddr-dns

```
github.com/multiformats/go-multiaddr-dns/
â”œâ”€â”€ resolve.go        # åœ°å€è§£æ
â””â”€â”€ dns.go            # DNS æŸ¥è¯¢

å…³é”®åŠŸèƒ½:
â€¢ dnsaddr é€’å½’è§£æ
â€¢ DNS ç»“æœç¼“å­˜
â€¢ å¹¶å‘è§£æ
```

### iroh DNS Discovery

```
iroh/src/discovery/dns.rs
â”œâ”€â”€ resolver          # DNS è§£æå™¨
â””â”€â”€ discovery         # DNS-SD å‘ç°

å…³é”®åŠŸèƒ½:
â€¢ Pkarr DNS å‘ç°
â€¢ DNS-over-HTTPS æ”¯æŒ
```

---

## é…ç½®å‚æ•°

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `CacheTTL` | 60s | DNS ç¼“å­˜æ—¶é—´ |
| `MaxDepth` | 10 | dnsaddr æœ€å¤§é€’å½’æ·±åº¦ |
| `Timeout` | 10s | DNS æŸ¥è¯¢è¶…æ—¶ |
| `Resolvers` | ç³»ç»Ÿé»˜è®¤ | DNS æœåŠ¡å™¨åˆ—è¡¨ |

---

## ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | è¯´æ˜ |
|------|------|
| [discovery_bootstrap](../discovery_bootstrap/) | å¼•å¯¼å‘ç° |
| [discovery_dht](../discovery_dht/) | DHT å‘ç° |
| [discovery_coordinator](../discovery_coordinator/) | å‘ç°åè°ƒå™¨ |
| [L2: äº”å±‚æ¶æ„](../../L2_structural/layer_model.md) | æ¶æ„å®šä¹‰ |

---

**æœ€åæ›´æ–°**ï¼š2026-01-13
