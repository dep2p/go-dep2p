# Discovery mDNS - å±€åŸŸç½‘èŠ‚ç‚¹å‘ç°

> **ç‰ˆæœ¬**: v1.0.0  
> **çŠ¶æ€**: âœ… å·²å®Œæˆ  
> **æ¶æ„å±‚**: Discovery Layer

---

## æ¦‚è¿°

`mdns` ä½¿ç”¨ mDNS (Multicast DNS) åè®®è¿›è¡Œå±€åŸŸç½‘å†…çš„èŠ‚ç‚¹è‡ªåŠ¨å‘ç°ï¼Œæ— éœ€ä¸­å¿ƒæœåŠ¡å™¨æˆ–äº’è”ç½‘è¿æ¥ã€‚

**æ ¸å¿ƒåŠŸèƒ½**:
- ğŸ“¡ æœåŠ¡å¹¿æ’­ - ä½¿ç”¨ zeroconf æ³¨å†Œ mDNS æœåŠ¡
- ğŸ” æœåŠ¡å‘ç° - ç›‘å¬å±€åŸŸç½‘å†…çš„ mDNS å¹¿æ’­
- ğŸ¯ åœ°å€è¿‡æ»¤ - åªå¹¿æ’­é€‚åˆ LAN çš„åœ°å€
- ğŸ”’ å¹¶å‘å®‰å…¨ - atomic + RWMutex ä¿æŠ¤

---

## å¿«é€Ÿå¼€å§‹

```go
import "github.com/dep2p/go-dep2p/internal/discovery/mdns"

// åˆ›å»º mDNS æœåŠ¡
config := mdns.DefaultConfig()
m, err := mdns.New(host, config)
if err != nil {
    log.Fatal(err)
}

// å¯åŠ¨æœåŠ¡
if err := m.Start(ctx); err != nil {
    log.Fatal(err)
}
defer m.Stop(ctx)

// å‘ç°èŠ‚ç‚¹
peerCh, err := m.FindPeers(ctx, "my-namespace")
for peer := range peerCh {
    fmt.Printf("å‘ç°èŠ‚ç‚¹: %s, åœ°å€: %v\n", peer.ID, peer.Addrs)
}

// å¹¿æ’­è‡ªèº«
ttl, err := m.Advertise(ctx, "my-namespace")
fmt.Printf("å¹¿æ’­ TTL: %v\n", ttl)
```

---

## æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              mDNS Service                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    Server     â”‚    â”‚     Resolver       â”‚   â”‚
â”‚  â”‚ (å¹¿æ’­èŠ‚ç‚¹ä¿¡æ¯) â”‚    â”‚ (ç›‘å¬å‘ç°èŠ‚ç‚¹)      â”‚   â”‚
â”‚  â”‚ RegisterProxy â”‚    â”‚    Browse          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚           Address Filter                   â”‚ â”‚
â”‚  â”‚  isSuitableForMDNS() - è¿‡æ»¤ LAN é€‚åˆåœ°å€   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              zeroconf (ç¬¬ä¸‰æ–¹åº“)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## åœ°å€è¿‡æ»¤

åªå¹¿æ’­é€‚åˆ LAN çš„åœ°å€ï¼š

| å…è®¸ | è¯´æ˜ |
|------|------|
| `/ip4/...` | IPv4 åœ°å€ |
| `/ip6/...` | IPv6 åœ°å€ |
| `*.local` | æœ¬åœ° DNS |

| æ’é™¤ | è¯´æ˜ |
|------|------|
| `/p2p-circuit/...` | Relay ç”µè·¯ |
| `/ws/...` | WebSocket |
| `/webrtc/...` | WebRTC |

---

## é…ç½®

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `ServiceTag` | `_dep2p._udp` | mDNS æœåŠ¡æ ‡ç­¾ |
| `Interval` | `10s` | å¹¿æ’­é—´éš” |
| `Enabled` | `true` | æ˜¯å¦å¯ç”¨ |

---

## é€‚ç”¨åœºæ™¯

- âœ… å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒ
- âœ… æ— äº’è”ç½‘è¿æ¥çš„ç§æœ‰ç½‘ç»œ
- âœ… å¿«é€ŸèŠ‚ç‚¹å‘ç°
- âœ… å±€åŸŸç½‘ P2P åº”ç”¨

## é™åˆ¶

- âš ï¸ ä»…é™å±€åŸŸç½‘ï¼ˆLANï¼‰å‘ç°
- âš ï¸ ä¸é€‚åˆå¤§è§„æ¨¡ç½‘ç»œï¼ˆæ¨èä½¿ç”¨ DHTï¼‰
- âš ï¸ ä¾èµ–ç½‘ç»œæ”¯æŒå¤šæ’­

---

## æµ‹è¯•

```bash
go test -v ./internal/discovery/mdns/...
go test -cover ./internal/discovery/mdns/...
```

---

## ç›¸å…³æ–‡æ¡£

- [doc.go](doc.go) - åŒ…æ–‡æ¡£
- [DESIGN_REVIEW.md](DESIGN_REVIEW.md) - è®¾è®¡è¯„å®¡

---

**æœ€åæ›´æ–°**: 2026-01-20
