# Discovery Coordinator - å‘ç°åè°ƒå™¨

> **ç‰ˆæœ¬**: v1.0.0  
> **çŠ¶æ€**: âœ… å·²å®Œæˆ  
> **æ¶æ„å±‚**: Discovery Layer

---

## æ¦‚è¿°

`coordinator` æ˜¯å‘ç°æœåŠ¡çš„**é—¨é¢æ¨¡å¼**å®ç°ï¼Œè´Ÿè´£ç»Ÿä¸€è°ƒåº¦å„ç§å‘ç°ç»„ä»¶ï¼ˆbootstrap, mdns, dht, rendezvous, dnsï¼‰ã€‚

**æ ¸å¿ƒåŠŸèƒ½**:
- ğŸ”„ èšåˆè°ƒåº¦ - ç»Ÿä¸€è°ƒåº¦æ‰€æœ‰å‘ç°å­æ¨¡å—
- ğŸš€ å¹¶è¡Œæ‰§è¡Œ - å¹¶è¡ŒæŸ¥è¯¢æ‰€æœ‰å‘ç°å™¨
- ğŸ§¹ ç»“æœå»é‡ - åŸºäº PeerID å»é‡åˆå¹¶
- âš¡ ä¼˜é›…é™çº§ - å•ä¸ªå¤±è´¥ä¸å½±å“å…¶ä»–

---

## å¿«é€Ÿå¼€å§‹

```go
import "github.com/dep2p/go-dep2p/internal/discovery/coordinator"

// åˆ›å»ºåè°ƒå™¨
config := coordinator.DefaultConfig()
coord := coordinator.NewCoordinator(config)

// æ³¨å†Œå‘ç°å™¨
coord.RegisterDiscovery("bootstrap", bootstrapDiscovery)
coord.RegisterDiscovery("mdns", mdnsDiscovery)
coord.RegisterDiscovery("dht", dhtDiscovery)

// å¯åŠ¨
if err := coord.Start(ctx); err != nil {
    log.Fatal(err)
}
defer coord.Stop(ctx)

// å‘ç°èŠ‚ç‚¹ï¼ˆå¹¶è¡ŒæŸ¥è¯¢æ‰€æœ‰å‘ç°å™¨ï¼‰
ch, err := coord.FindPeers(ctx, "myapp", interfaces.WithLimit(10))
for peer := range ch {
    fmt.Printf("å‘ç°èŠ‚ç‚¹: %s\n", peer.ID)
}

// å¹¿æ’­è‡ªèº«
ttl, err := coord.Advertise(ctx, "myapp", interfaces.WithTTL(time.Hour))
```

---

## æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Coordinatorï¼ˆé—¨é¢ï¼‰                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ FindPeers()  - å¹¶è¡ŒæŸ¥è¯¢æ‰€æœ‰å‘ç°å™¨ï¼Œåˆå¹¶å»é‡                        â”‚
â”‚  â€¢ Advertise()  - å‘æ”¯æŒå¹¿æ’­çš„å‘ç°å™¨å¹¿æ’­                             â”‚
â”‚  â€¢ Start()      - å¯åŠ¨æ‰€æœ‰å­å‘ç°å™¨                                   â”‚
â”‚  â€¢ Stop()       - åœæ­¢æ‰€æœ‰å­å‘ç°å™¨                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚          â”‚          â”‚          â”‚          â”‚
               â–¼          â–¼          â–¼          â–¼          â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚bootstrap â”‚ â”‚  mdns    â”‚ â”‚   dht    â”‚ â”‚rendezvousâ”‚ â”‚   dns    â”‚
         â”‚(å¼•å¯¼èŠ‚ç‚¹)â”‚ â”‚(å±€åŸŸç½‘)  â”‚ â”‚(Kademlia)â”‚ â”‚(å‘½åç©ºé—´)â”‚ â”‚(DNS-SD)  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å‘ç°ç­–ç•¥

| ç­–ç•¥ | è¯´æ˜ |
|------|------|
| **å¹¶è¡ŒæŸ¥è¯¢** | æ‰€æœ‰å‘ç°å™¨åŒæ—¶æ‰§è¡Œï¼Œæé«˜å‘ç°é€Ÿåº¦ |
| **ç»“æœå»é‡** | åŸºäº PeerID å»é‡ï¼Œé¿å…é‡å¤èŠ‚ç‚¹ |
| **è¶…æ—¶æ§åˆ¶** | æ”¯æŒé…ç½®å‘ç°è¶…æ—¶ï¼Œé˜²æ­¢é˜»å¡ |
| **ä¼˜é›…é™çº§** | å•ä¸ªå‘ç°å™¨å¤±è´¥ä¸å½±å“å…¶ä»– |

---

## é…ç½®

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `FindTimeout` | `30s` | å‘ç°è¶…æ—¶æ—¶é—´ |
| `AdvertiseTimeout` | `10s` | å¹¿æ’­è¶…æ—¶æ—¶é—´ |
| `EnableCache` | `true` | æ˜¯å¦å¯ç”¨èŠ‚ç‚¹ç¼“å­˜ |
| `CacheTTL` | `5min` | ç¼“å­˜è¿‡æœŸæ—¶é—´ |

---

## ç”Ÿå‘½å‘¨æœŸ

1. **åˆ›å»º**: `NewCoordinator()`
2. **æ³¨å†Œ**: `RegisterDiscovery()` - å¯åœ¨å¯åŠ¨å‰æˆ–å¯åŠ¨å
3. **å¯åŠ¨**: `Start()` - å¯åŠ¨æ‰€æœ‰å·²æ³¨å†Œçš„å‘ç°å™¨
4. **è¿è¡Œ**: `FindPeers()` / `Advertise()` - æ­£å¸¸ä½¿ç”¨
5. **åœæ­¢**: `Stop()` - åœæ­¢æ‰€æœ‰å‘ç°å™¨

---

## æµ‹è¯•

```bash
go test -v ./internal/discovery/coordinator/...
go test -cover ./internal/discovery/coordinator/...
```

---

**æœ€åæ›´æ–°**: 2026-01-20
