# Core Host - ç½‘ç»œä¸»æœº

> **ç‰ˆæœ¬**: v1.0.0  
> **çŠ¶æ€**: âœ… å·²å®Œæˆ  
> **æ¶æ„å±‚**: Core Layer

---

## æ¦‚è¿°

`host` æ˜¯ Core Layer çš„èšåˆç‚¹ï¼Œé‡‡ç”¨é—¨é¢ï¼ˆFacadeï¼‰æ¨¡å¼æ•´åˆ Swarmã€Protocolã€NATã€Relay ç­‰å­ç³»ç»Ÿï¼Œä¸ºä¸Šå±‚æä¾›ç»Ÿä¸€çš„ç½‘ç»œæœåŠ¡æ¥å£ã€‚

**æ ¸å¿ƒåŠŸèƒ½**:
- ğŸ”— è¿æ¥ç®¡ç† - å»ºç«‹å’Œç»´æŠ¤èŠ‚ç‚¹è¿æ¥
- ğŸ“¡ åè®®è·¯ç”± - æ³¨å†Œå’Œåˆ†å‘åè®®å¤„ç†å™¨
- ğŸŒ åœ°å€ç®¡ç† - ç›‘å¬åœ°å€å’Œå¤–éƒ¨åœ°å€
- ğŸ”„ ç”Ÿå‘½å‘¨æœŸ - å¯åŠ¨ã€åœæ­¢ã€ä¼˜é›…å…³é—­

---

## å¿«é€Ÿå¼€å§‹

```go
import "github.com/dep2p/go-dep2p/internal/core/host"

// åˆ›å»º Host
h, err := host.New(
    host.WithSwarm(swarm),
    host.WithPeerstore(peerstore),
    host.WithEventBus(eventbus),
)
if err != nil {
    log.Fatal(err)
}
defer h.Close()

// å¯åŠ¨ Host
err = h.Start(ctx)

// è¿æ¥èŠ‚ç‚¹
err = h.Connect(ctx, peerID, addrs)

// æ³¨å†Œåè®®å¤„ç†å™¨
h.SetStreamHandler("/my/proto/1.0.0", handler)

// åˆ›å»ºæµ
stream, err := h.NewStream(ctx, peerID, "/my/proto/1.0.0")
```

---

## æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Host                          â”‚
â”‚  (é—¨é¢æ¨¡å¼ - èšåˆåº•å±‚ç»„ä»¶)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Connect()      â†’ Peerstore + Swarm              â”‚
â”‚  NewStream()    â†’ Swarm + Protocol               â”‚
â”‚  SetHandler()   â†’ Protocol                       â”‚
â”‚  Addrs()        â†’ Swarm + NAT + Coordinator      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼             â–¼             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Swarm  â”‚  â”‚ Protocol â”‚  â”‚Peerstoreâ”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¾èµ–ç»„ä»¶

| ç»„ä»¶ | èŒè´£ | å¿…é€‰ |
|------|------|------|
| Swarm | è¿æ¥æ± ç®¡ç† | âœ… |
| Peerstore | èŠ‚ç‚¹ä¿¡æ¯å­˜å‚¨ | âœ… |
| Protocol | åè®®æ³¨å†Œå’Œè·¯ç”± | âœ… |
| EventBus | äº‹ä»¶é€šçŸ¥ | âœ… |
| ConnManager | è¿æ¥ç”Ÿå‘½å‘¨æœŸ | â¬œ |
| NAT | NAT ç©¿é€ | â¬œ |
| Relay | ä¸­ç»§æœåŠ¡ | â¬œ |

---

## API æ¦‚è§ˆ

### åŸºæœ¬æ“ä½œ

```go
// èº«ä»½
ID() string                           // è·å–æœ¬åœ°èŠ‚ç‚¹ ID
Addrs() []string                      // è·å–ç›‘å¬åœ°å€
AdvertisedAddrs() []string            // è·å–å¯¹å¤–å…¬å‘Šåœ°å€
ShareableAddrs() []string             // è·å–å¯åˆ†äº«åœ°å€

// è¿æ¥
Connect(ctx, peerID, addrs) error     // è¿æ¥åˆ°èŠ‚ç‚¹
Peerstore() Peerstore                 // è·å– Peerstore

// åè®®
SetStreamHandler(protocolID, handler) // æ³¨å†Œåè®®å¤„ç†å™¨
NewStream(ctx, peerID, protocolID)    // åˆ›å»ºæ–°æµ
RemoveStreamHandler(protocolID)       // ç§»é™¤å¤„ç†å™¨

// ç”Ÿå‘½å‘¨æœŸ
Start(ctx) error                      // å¯åŠ¨
Close() error                         // å…³é—­
```

---

## åœ°å€ç±»å‹

| ç±»å‹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| ç›‘å¬åœ°å€ | `Addrs()` | æœ¬åœ°ç›‘å¬çš„åœ°å€ |
| å…¬å‘Šåœ°å€ | `AdvertisedAddrs()` | å¯¹å¤–å…¬å‘Šï¼ˆå« Relayï¼‰ |
| å¯åˆ†äº«åœ°å€ | `ShareableAddrs()` | å·²éªŒè¯çš„å…¬ç½‘åœ°å€ |

---

## æµ‹è¯•

```bash
# å•å…ƒæµ‹è¯•
go test -v ./internal/core/host/...

# è¦†ç›–ç‡
go test -cover ./internal/core/host/...

# ç«æ€æ£€æµ‹
go test -race ./internal/core/host/...
```

---

## ç›¸å…³æ–‡æ¡£

- [doc.go](doc.go) - åŒ…æ–‡æ¡£
- [DESIGN_REVIEW.md](DESIGN_REVIEW.md) - è®¾è®¡è¯„å®¡

---

**æœ€åæ›´æ–°**: 2026-01-20
