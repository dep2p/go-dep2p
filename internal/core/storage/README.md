# Core Storage - å­˜å‚¨å¼•æ“

> **ç‰ˆæœ¬**: v1.0.0  
> **çŠ¶æ€**: âœ… å·²å®Œæˆ  
> **æ¶æ„å±‚**: Core Layer

---

## æ¦‚è¿°

`storage` æ¨¡å—æä¾›æŒä¹…åŒ–å­˜å‚¨èƒ½åŠ›ï¼Œä¸º Peerstoreã€DHTã€Rendezvous ç­‰ç»„ä»¶æä¾›æ•°æ®å­˜å‚¨æœåŠ¡ã€‚

**æ ¸å¿ƒåŠŸèƒ½**:
- ğŸ’¾ KV å­˜å‚¨ - é”®å€¼å¯¹å­˜å‚¨æ¥å£
- ğŸ—„ï¸ BadgerDB - é»˜è®¤å­˜å‚¨å¼•æ“
- ğŸ”„ äº‹åŠ¡æ”¯æŒ - åŸå­æ“ä½œ
- ğŸ“¦ å‘½åç©ºé—´ - æ•°æ®éš”ç¦»

---

## å¿«é€Ÿå¼€å§‹

```go
import "github.com/dep2p/go-dep2p/internal/core/storage"

// åˆ›å»ºå­˜å‚¨å¼•æ“
engine, err := storage.NewBadgerEngine(storage.Config{
    Path: "/path/to/data",
})
if err != nil {
    log.Fatal(err)
}
defer engine.Close()

// åŸºæœ¬æ“ä½œ
err = engine.Put([]byte("key"), []byte("value"))
value, err := engine.Get([]byte("key"))
err = engine.Delete([]byte("key"))

// äº‹åŠ¡
err = engine.Update(func(txn storage.Txn) error {
    txn.Set([]byte("k1"), []byte("v1"))
    txn.Set([]byte("k2"), []byte("v2"))
    return nil
})
```

---

## å­æ¨¡å—

| å­ç›®å½• | åŠŸèƒ½ | è¯´æ˜ |
|--------|------|------|
| `engine/` | å­˜å‚¨å¼•æ“æŠ½è±¡ | å¼•æ“æ¥å£å®šä¹‰ |
| `engine/badger/` | BadgerDB å®ç° | é»˜è®¤å­˜å‚¨å¼•æ“ |
| `kv/` | KV å­˜å‚¨æ¥å£ | ç®€åŒ–çš„é”®å€¼æ¥å£ |

---

## æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Storage Interface                   â”‚
â”‚         (pkg/interfaces/storage.go)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Get() | Put() | Delete() | Has() | Iterator()  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              BadgerDB Engine                     â”‚
â”‚         (internal/core/storage/engine/badger)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä½¿ç”¨è€…

| ç»„ä»¶ | ç”¨é€” |
|------|------|
| Peerstore | èŠ‚ç‚¹åœ°å€ã€å¯†é’¥æŒä¹…åŒ– |
| DHT | è·¯ç”±è¡¨ã€Provider è®°å½• |
| Rendezvous | æ³¨å†Œè®°å½• |
| Relay AddressBook | ä¸­ç»§åœ°å€ç°¿ |

---

## é…ç½®

```go
config := &storage.Config{
    Path:          "/path/to/data",    // æ•°æ®ç›®å½•
    InMemory:      false,              // æ˜¯å¦å†…å­˜æ¨¡å¼
    GCInterval:    5 * time.Minute,    // GC é—´éš”
    SyncWrites:    true,               // åŒæ­¥å†™å…¥
}
```

---

## æµ‹è¯•

```bash
# å•å…ƒæµ‹è¯•
go test -v ./internal/core/storage/...

# è¦†ç›–ç‡
go test -cover ./internal/core/storage/...
```

---

**æœ€åæ›´æ–°**: 2026-01-20
