# Core Recovery - ç½‘ç»œæ¢å¤

> **ç‰ˆæœ¬**: v1.0.0  
> **çŠ¶æ€**: âœ… å·²å®Œæˆ  
> **æ¶æ„å±‚**: Core Layer

---

## æ¦‚è¿°

`recovery` æ¨¡å—æä¾›ç½‘ç»œæ¢å¤åŠŸèƒ½ï¼Œå½“ç½‘ç»œå‡ºç°æ•…éšœæ—¶è‡ªåŠ¨æ‰§è¡Œæ¢å¤æ“ä½œã€‚

**æ ¸å¿ƒåŠŸèƒ½**:
- ğŸ”„ è‡ªåŠ¨æ¢å¤ - æ£€æµ‹æ•…éšœå¹¶è§¦å‘æ¢å¤æµç¨‹
- ğŸ”Œ Rebind - é‡å»ºåº•å±‚ä¼ è¾“ï¼ˆUDP socketï¼‰
- ğŸŒ åœ°å€é‡å‘ç° - é€šè¿‡ STUN è·å–æ–°åœ°å€
- ğŸ”— è¿æ¥é‡å»º - æ¢å¤å…³é”®èŠ‚ç‚¹è¿æ¥

---

## å¿«é€Ÿå¼€å§‹

```go
import "github.com/dep2p/go-dep2p/internal/core/recovery"

// åˆ›å»ºæ¢å¤ç®¡ç†å™¨
config := recovery.DefaultConfig()
manager := recovery.NewManager(config)

// è®¾ç½®ä¾èµ–ç»„ä»¶
manager.SetConnector(connector)
manager.SetRebinder(rebinder)
manager.SetAddressDiscoverer(discoverer)

// è®¾ç½®å…³é”®èŠ‚ç‚¹
manager.SetCriticalPeers([]string{"peer1", "peer2"})

// å¯åŠ¨ç®¡ç†å™¨
manager.Start(ctx)
defer manager.Stop()

// æ³¨å†Œå›è°ƒ
manager.OnRecoveryComplete(func(result RecoveryResult) {
    if result.Success {
        log.Info("æ¢å¤æˆåŠŸ")
    }
})
```

---

## å­æ¨¡å—

| å­ç›®å½• | åŠŸèƒ½ | å…¬å…±æ¥å£ |
|--------|------|---------|
| `netmon/` | è¿æ¥å¥åº·ç›‘æ§ | ConnectionHealthMonitor (recovery.go) |
| `netmon/watcher/` | ç³»ç»Ÿç½‘ç»œç›‘æ§ | NetworkMonitor (recovery.go) |

---

## æ¢å¤æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. æ£€æµ‹åˆ°ç½‘ç»œæ•…éšœï¼ˆNetworkMonitorï¼‰              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. è§¦å‘æ¢å¤æµç¨‹ï¼ˆTriggerRecoveryï¼‰              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. Rebind åº•å±‚ä¼ è¾“ï¼ˆå¦‚éœ€è¦ï¼‰                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. é‡æ–°å‘ç°å¤–éƒ¨åœ°å€ï¼ˆSTUNï¼‰                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. é‡å»ºå…³é”®èŠ‚ç‚¹è¿æ¥                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. é€šçŸ¥æ¢å¤ç»“æœï¼ˆå›è°ƒï¼‰                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## é…ç½®

```go
config := &recovery.Config{
    MaxAttempts:          5,               // æœ€å¤§å°è¯•æ¬¡æ•°
    RecoveryTimeout:      30 * time.Second, // å•æ¬¡è¶…æ—¶
    RebindOnCriticalError: true,           // å…³é”®é”™è¯¯æ—¶ rebind
    RediscoverAddresses:   true,           // é‡æ–°å‘ç°åœ°å€
}
```

---

## æµ‹è¯•

```bash
# å•å…ƒæµ‹è¯•
go test -v ./internal/core/recovery/...

# è¦†ç›–ç‡
go test -cover ./internal/core/recovery/...
```

---

**æœ€åæ›´æ–°**: 2026-01-20
