# Core Swarm - è¿æ¥ç¾¤ç®¡ç†

> **ç‰ˆæœ¬**: v1.0.0  
> **çŠ¶æ€**: âœ… å·²å®Œæˆ  
> **æ¶æ„å±‚**: Core Layer

---

## æ¦‚è¿°

`swarm` æ˜¯ DeP2P ç½‘ç»œå±‚çš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£ç®¡ç†èŠ‚ç‚¹é—´çš„æ‰€æœ‰è¿æ¥å’Œæµã€‚å®ƒä½œä¸º Host çš„åº•å±‚å¼•æ“ï¼Œå¤„ç†å¤šè·¯å¤ç”¨è¿æ¥æ± ã€æ‹¨å·è°ƒåº¦ã€è¿æ¥ç”Ÿå‘½å‘¨æœŸç®¡ç†ç­‰å…³é”®åŠŸèƒ½ã€‚

**æ ¸å¿ƒåŠŸèƒ½**:
- ğŸ”— è¿æ¥æ± ç®¡ç† - ç»´æŠ¤å¤šè·¯å¤ç”¨è¿æ¥
- ğŸ“ æ‹¨å·è°ƒåº¦ - æ™ºèƒ½åœ°å€æ’åºå’Œå¹¶å‘æ‹¨å·
- ğŸ‘‚ ç›‘å¬ç®¡ç† - å¤šåœ°å€ç›‘å¬å’Œå…¥ç«™è¿æ¥
- ğŸŒŠ æµç®¡ç† - æµåˆ›å»ºå’Œå¤ç”¨
- ğŸ“¢ äº‹ä»¶é€šçŸ¥ - è¿æ¥/æµäº‹ä»¶

---

## å¿«é€Ÿå¼€å§‹

```go
import "github.com/dep2p/go-dep2p/internal/core/swarm"

// åˆ›å»º Swarm
s, err := swarm.NewSwarm("local-peer-id")
if err != nil {
    log.Fatal(err)
}
defer s.Close()

// æ·»åŠ ä¼ è¾“å±‚
s.AddTransport("quic", quicTransport)
s.AddTransport("tcp", tcpTransport)

// è®¾ç½®å‡çº§å™¨
s.SetUpgrader(upgrader)

// ç›‘å¬åœ°å€
err = s.Listen("/ip4/0.0.0.0/udp/4001/quic-v1")

// æ‹¨å·è¿æ¥
conn, err := s.DialPeer(ctx, "remote-peer-id")

// åˆ›å»ºæµ
stream, err := s.NewStream(ctx, "remote-peer-id")
```

---

## å­æ¨¡å—

| å­ç›®å½• | åŠŸèƒ½ | å…¬å…±æ¥å£ |
|--------|------|---------|
| `bandwidth/` | å¸¦å®½ç»Ÿè®¡ | BandwidthCounter (swarm.go) |
| `pathhealth/` | è·¯å¾„å¥åº·ç®¡ç† | PathHealthManager (swarm.go) |
| `dial/` | æ‹¨å·è°ƒåº¦ | å†…éƒ¨å®ç° |

---

## æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Swarm                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Dial Mgr â”‚  â”‚ Listen Manager â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     Connection Pool          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          Upgrader                   â”‚
â”‚  Security (TLS) + Muxer (Yamux)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Transports                  â”‚
â”‚      QUIC  |  TCP                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ‹¨å·ç­–ç•¥

**åœ°å€ä¼˜å…ˆçº§**:
1. æœ¬åœ°ç½‘ç»œåœ°å€
2. QUIC åœ°å€
3. TCP åœ°å€

**å¹¶å‘æ‹¨å·**:
- åŒæ—¶å°è¯•å¤šä¸ªåœ°å€
- ç¬¬ä¸€ä¸ªæˆåŠŸçš„è¿æ¥èƒœå‡º
- å…¶ä»–æ‹¨å·è‡ªåŠ¨å–æ¶ˆ

---

## é…ç½®

```go
config := &swarm.Config{
    DialTimeout:        15 * time.Second,  // è¿œç¨‹æ‹¨å·è¶…æ—¶
    DialTimeoutLocal:   5 * time.Second,   // æœ¬åœ°æ‹¨å·è¶…æ—¶
    NewStreamTimeout:   15 * time.Second,  // åˆ›å»ºæµè¶…æ—¶
    MaxConcurrentDials: 100,               // æœ€å¤§å¹¶å‘æ‹¨å·

    // è¿æ¥å¥åº·æ£€æµ‹é…ç½®
    ConnHealthInterval: 30 * time.Second,  // å¥åº·æ£€æµ‹é—´éš”ï¼ˆ0 è¡¨ç¤ºç¦ç”¨ï¼‰
    ConnHealthTimeout:  10 * time.Second,  // å•æ¬¡æ£€æµ‹è¶…æ—¶
}
```

---

## æµ‹è¯•

```bash
# å•å…ƒæµ‹è¯•
go test -v ./internal/core/swarm/...

# è¦†ç›–ç‡
go test -cover ./internal/core/swarm/...
```

---

**æœ€åæ›´æ–°**: 2026-01-20
