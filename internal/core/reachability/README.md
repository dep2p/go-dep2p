# Core Reachability - å¯è¾¾æ€§åè°ƒ

> **ç‰ˆæœ¬**: v1.0.0  
> **çŠ¶æ€**: âœ… å·²å®Œæˆ  
> **æ¶æ„å±‚**: Core Layer

---

## æ¦‚è¿°

`reachability` æ¨¡å—è´Ÿè´£åè°ƒèŠ‚ç‚¹çš„å¯è¾¾æ€§çŠ¶æ€å’Œåœ°å€ç®¡ç†ï¼Œæ•´åˆæ¥è‡ªå¤šä¸ªæ¥æºï¼ˆNATã€STUNã€ç½‘å¡ã€ç”¨æˆ·é…ç½®ï¼‰çš„åœ°å€ä¿¡æ¯ã€‚

**æ ¸å¿ƒåŠŸèƒ½**:
- ğŸ“ åœ°å€åè°ƒ - æ•´åˆå¤šæ¥æºåœ°å€
- âœ… åœ°å€éªŒè¯ - éªŒè¯åœ°å€å¯è¾¾æ€§
- ğŸ“¢ åœ°å€å…¬å‘Š - ç®¡ç†å¯¹å¤–å…¬å‘Šçš„åœ°å€
- ğŸ”„ çŠ¶æ€åŒæ­¥ - åè°ƒå¯è¾¾æ€§çŠ¶æ€å˜æ›´

---

## å¿«é€Ÿå¼€å§‹

```go
import "github.com/dep2p/go-dep2p/internal/core/reachability"

// åˆ›å»ºåè°ƒå™¨
coordinator := reachability.NewCoordinator(config, eventbus)

// å¯åŠ¨
coordinator.Start(ctx)
defer coordinator.Stop()

// æ·»åŠ å·²éªŒè¯çš„åœ°å€
coordinator.AddVerifiedAddress(addr, reachability.SourceSTUN)

// è·å–å¯åˆ†äº«åœ°å€
addrs := coordinator.ShareableAddrs()

// è·å–å…¬å‘Šåœ°å€
advertised := coordinator.AdvertisedAddrs()
```

---

## å­æ¨¡å—

| å­ç›®å½• | åŠŸèƒ½ | è¯´æ˜ |
|--------|------|------|
| `addrmgmt/` | åœ°å€ç®¡ç†åè®® | ç³»ç»Ÿåè®®ï¼Œå¤„ç†åœ°å€æ›´æ–° |

---

## åœ°å€æ¥æº

| æ¥æº | ä¼˜å…ˆçº§ | è¯´æ˜ |
|------|--------|------|
| ç”¨æˆ·é…ç½® | æœ€é«˜ | `WithPublicAddr()` é…ç½®çš„åœ°å€ |
| STUN å‘ç° | é«˜ | é€šè¿‡ STUN æœåŠ¡å™¨å‘ç° |
| å›æ‹¨éªŒè¯ | é«˜ | å…¶ä»–èŠ‚ç‚¹éªŒè¯æˆåŠŸ |
| ç½‘å¡æ‰«æ | ä¸­ | æœ¬åœ°ç½‘å¡å…¬ç½‘åœ°å€ |
| ç›‘å¬åœ°å€ | ä½ | æœ¬åœ°ç›‘å¬åœ°å€ |

---

## åœ°å€ç±»å‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ‰€æœ‰åœ°å€æ¥æº                        â”‚
â”‚  (STUN, NAT, ç½‘å¡, ç”¨æˆ·é…ç½®, ç›‘å¬)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ è¿‡æ»¤å’ŒéªŒè¯
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          AdvertisedAddrs (å…¬å‘Šåœ°å€)              â”‚
â”‚  åŒ…å«: å·²éªŒè¯ç›´è¿ + Relay ç”µè·¯åœ°å€               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ ä»…å…¬ç½‘ç›´è¿
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ShareableAddrs (å¯åˆ†äº«åœ°å€)             â”‚
â”‚  ä»…: å·²éªŒè¯çš„å…¬ç½‘ç›´è¿åœ°å€                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æµ‹è¯•

```bash
# å•å…ƒæµ‹è¯•
go test -v ./internal/core/reachability/...

# è¦†ç›–ç‡
go test -cover ./internal/core/reachability/...
```

---

**æœ€åæ›´æ–°**: 2026-01-20
