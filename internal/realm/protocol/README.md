# Realm Protocol - åè®®å¤„ç†å™¨

> **ç‰ˆæœ¬**: v2.0.0  
> **çŠ¶æ€**: âœ… å·²å®Œæˆ  
> **æ¶æ„å±‚**: Realm Layer

---

## æ¦‚è¿°

`protocol` å®ç° Realm çº§åˆ«çš„ç½‘ç»œåè®®å¤„ç†å™¨ï¼Œæä¾›è®¤è¯ã€åŒæ­¥ç­‰åè®®çš„ç½‘ç»œå°è£…ã€‚

**æ ¸å¿ƒåŠŸèƒ½**:
- ğŸ” è®¤è¯åè®® - æˆå‘˜èº«ä»½éªŒè¯
- ğŸ”„ åŒæ­¥åè®® - æˆå‘˜åˆ—è¡¨åŒæ­¥
- ğŸ“¦ åè®®å°è£… - ç½‘ç»œé€šä¿¡å°è£…

> **v2.0 å˜æ›´**ï¼šåºŸå¼ƒå…¥å£èŠ‚ç‚¹å’Œ Join åè®®ï¼Œé‡‡ç”¨"å…ˆå‘å¸ƒåå‘ç°"æ¨¡å¼ã€‚
> æˆå‘˜å‘ç°é€šè¿‡ DHT Provider Record å®ç°ã€‚

---

## åè®® ID æ ¼å¼

æ‰€æœ‰åè®® ID åŒ…å« RealmIDï¼Œç¡®ä¿åè®®çº§åˆ«éš”ç¦»ï¼š

```
/dep2p/realm/<realmID>/auth/1.0.0    - è®¤è¯åè®®
/dep2p/realm/<realmID>/sync/1.0.0    - åŒæ­¥åè®®
```

---

## å¿«é€Ÿå¼€å§‹

### è®¤è¯åè®®

```go
import "github.com/dep2p/go-dep2p/internal/realm/protocol"

// åˆ›å»ºè®¤è¯å¤„ç†å™¨
authHandler := protocol.NewAuthHandler(host, realmID, authKey, authenticator, nil)

// å¯åŠ¨å¤„ç†å™¨ï¼ˆæ³¨å†Œåè®®ï¼‰
err := authHandler.Start(ctx)

// å‘è¿œç¨‹èŠ‚ç‚¹å‘èµ·è®¤è¯
err = authHandler.Authenticate(ctx, peerID)

// åœæ­¢å¤„ç†å™¨
err = authHandler.Stop(ctx)
```

### åŒæ­¥åè®®

```go
// åˆ›å»ºåŒæ­¥å¤„ç†å™¨
syncHandler := protocol.NewSyncHandler(host, realmID, memberManager)

// å¯åŠ¨å¤„ç†å™¨
err := syncHandler.Start(ctx)

// è¯·æ±‚æˆå‘˜åˆ—è¡¨åŒæ­¥
members, err := syncHandler.RequestSync(ctx, peerID)
```

---

## æ¶æ„è®¾è®¡

åè®®å±‚å¤ç”¨ `auth`/`member` ç­‰åŒ…çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œåªè´Ÿè´£åè®®å°è£…ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Protocol Handlers                   â”‚
â”‚  AuthHandler | SyncHandler                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  - æ³¨å†Œåè®®åˆ° Host                               â”‚
â”‚  - å¤„ç†æµçš„è¯»å†™                                  â”‚
â”‚  - è½¬å‘åˆ°ä¸šåŠ¡å±‚å¤„ç†                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Business Logic                      â”‚
â”‚  auth/ | member/ | ...                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## è®¾è®¡åŸåˆ™

1. **å¤ç”¨è€Œéé‡å¤** - å¤ç”¨ `auth/challenge.go` çš„è®¤è¯é€»è¾‘
2. **å•ä¸€èŒè´£** - åè®®å±‚åªè´Ÿè´£ç½‘ç»œé€šä¿¡å°è£…
3. **æ¥å£é©±åŠ¨** - ä¾èµ– `interfaces.Host` ç­‰æŠ½è±¡æ¥å£

---

## æµ‹è¯•

```bash
go test -v ./internal/realm/protocol/...
go test -cover ./internal/realm/protocol/...
```

---

## ç›¸å…³æ–‡æ¡£

- [doc.go](doc.go) - åŒ…æ–‡æ¡£
- [IMPLEMENTATION_SUMMARY.md](IMPLEMENTATION_SUMMARY.md) - å®ç°æ€»ç»“

---

**æœ€åæ›´æ–°**: 2026-01-26
