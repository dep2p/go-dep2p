# DeP2P ç¤ºä¾‹

## ç¤ºä¾‹åˆ—è¡¨

| ç¤ºä¾‹ | è¯´æ˜ | ç½‘ç»œç¯å¢ƒ |
|------|------|----------|
| [chat](chat/) | **ç»Ÿä¸€ P2P èŠå¤©** | ä»»æ„ç½‘ç»œï¼ˆmDNS + Bootstrap + Relayï¼‰ |
| ~~chat-local~~ | (å·²åˆå¹¶åˆ° chat) | - |
| ~~chat-network~~ | (å·²åˆå¹¶åˆ° chat) | - |

> **æ³¨æ„**: `chat-local` å’Œ `chat-network` å·²åˆå¹¶ä¸ºç»Ÿä¸€çš„ `chat` ç¤ºä¾‹ã€‚
> æ–°çš„ `chat` æ”¯æŒé›¶é…ç½®å¯åŠ¨ï¼ˆå±€åŸŸç½‘ mDNSï¼‰å’Œè·¨ç½‘ç»œé€šä¿¡ï¼ˆBootstrap + Relayï¼‰ã€‚

---

## å¿«é€Ÿå¼€å§‹

### åœºæ™¯ 1ï¼šé›¶é…ç½®å¯åŠ¨ï¼ˆå±€åŸŸç½‘èŠå¤©ï¼‰

åŒä¸€å±€åŸŸç½‘å†…çš„èŠ‚ç‚¹é€šè¿‡ mDNS è‡ªåŠ¨å‘ç°å¹¶è¿æ¥ï¼š

```bash
# ç»ˆç«¯ 1
go run ./examples/chat

# ç»ˆç«¯ 2ï¼ˆåŒä¸€å±€åŸŸç½‘ï¼‰
go run ./examples/chat
```

æ— éœ€ä»»ä½•é…ç½®ï¼ŒèŠ‚ç‚¹è‡ªåŠ¨äº’ç›¸å‘ç°ã€‚

---

### åœºæ™¯ 2ï¼šç›´æ¥è¿æ¥ï¼ˆçŸ¥é“å¯¹æ–¹åœ°å€ï¼‰

```bash
# èŠ‚ç‚¹ A
go run ./examples/chat
# æ˜¾ç¤ºåœ°å€ï¼š/ip4/192.168.1.100/udp/9000/quic-v1/p2p/12D3KooW...

# èŠ‚ç‚¹ B
go run ./examples/chat
[me] /connect /ip4/192.168.1.100/udp/9000/quic-v1/p2p/12D3KooW...
# âœ… å·²è¿æ¥
```

---

### åœºæ™¯ 3ï¼šè·¨ç½‘ç»œèŠå¤©ï¼ˆå¼•å¯¼ + ä¸­ç»§ï¼‰

é€‚ç”¨äºä¸åŒç½‘ç»œç¯å¢ƒï¼ˆå®¶é‡Œ WiFiã€å…¬å¸ç½‘ç»œã€4G ç§»åŠ¨ç½‘ç»œï¼‰ã€‚

#### æ­¥éª¤ 1ï¼šéƒ¨ç½²åŸºç¡€è®¾æ–½èŠ‚ç‚¹ï¼ˆäº‘æœåŠ¡å™¨ï¼‰

```bash
go run ./examples/chat \
    --serve \
    --port 4001 \
    --public-addr "/ip4/YOUR_PUBLIC_IP/udp/4001/quic-v1"
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
ğŸ”— è¿æ¥åœ°å€ï¼ˆåˆ†äº«ç»™å…¶ä»–äººï¼‰:
   /ip4/1.2.3.4/udp/4001/quic-v1/p2p/12D3KooWxxxxxxxx
```

#### æ­¥éª¤ 2ï¼šå®¢æˆ·ç«¯è¿æ¥

```bash
# WiFi / 4G / åŠå…¬ç½‘ç»œ
go run ./examples/chat \
    --bootstrap "/ip4/1.2.3.4/udp/4001/quic-v1/p2p/12D3KooWxxxxxxxx" \
    --relay "/ip4/1.2.3.4/udp/4001/quic-v1/p2p/12D3KooWxxxxxxxx"
```

---

## å‘½ä»¤è¡Œå‚æ•°

```bash
go run ./examples/chat [é€‰é¡¹]

Node å±‚é…ç½®ï¼ˆå¯åŠ¨å‰ï¼‰ï¼š
  --bootstrap <addr>      å¼•å¯¼èŠ‚ç‚¹åœ°å€ï¼ˆé€—å·åˆ†éš”å¤šä¸ªï¼‰
  --relay <addr>          Relay åœ°å€

æœåŠ¡èƒ½åŠ›å¼€å…³ï¼š
  --serve                 æœåŠ¡æ¨¡å¼ï¼šå¯ç”¨ Bootstrap + Relay èƒ½åŠ›
  --public-addr <addr>    å…¬ç½‘åœ°å€ï¼ˆ--serve æ—¶å¿…éœ€ï¼‰

å…¶ä»–ï¼š
  --port <port>           ç›‘å¬ç«¯å£ï¼ˆ0 = éšæœºï¼‰
  --nick <name>           æ˜µç§°
  --realm-key <key>       Realm PSK
```

---

## èŠå¤©å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `<æ¶ˆæ¯>` | å‘é€ç¾¤èŠ |
| `/msg <ID> <æ¶ˆæ¯>` | ç§èŠï¼ˆID å¯åªè¾“å‰å‡ ä½ï¼‰ |
| `/connect <åœ°å€>` | ç›´æ¥è¿æ¥èŠ‚ç‚¹ |
| `/peers` | åˆ—å‡ºåœ¨çº¿æˆå‘˜ |
| `/status` | æŸ¥çœ‹ç½‘ç»œçŠ¶æ€ |
| `/gateway set <åœ°å€>` | è®¾ç½® Gatewayï¼ˆè¿è¡Œæ—¶ï¼‰ |
| `/gateway enable` | å¯ç”¨ Gateway æœåŠ¡ |
| `/sub <ä¸»é¢˜>` | è®¢é˜…æ–°ä¸»é¢˜ |
| `/unsub <ä¸»é¢˜>` | å–æ¶ˆè®¢é˜… |
| `/topics` | åˆ—å‡ºå·²è®¢é˜…ä¸»é¢˜ |
| `/info` | æ˜¾ç¤ºèŠ‚ç‚¹ä¿¡æ¯ |
| `/help` | æ˜¾ç¤ºå¸®åŠ© |
| `/quit` | é€€å‡º |

---

## æ¶æ„è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Node å±‚é…ç½®ï¼ˆå¯åŠ¨å‰ï¼‰                                            â”‚
â”‚    --bootstrap    å¼•å¯¼èŠ‚ç‚¹ï¼ˆå¯åŠ¨å‰é…ç½®ï¼Œä¸å¯è¿è¡Œæ—¶æ›´æ”¹ï¼‰           â”‚
â”‚    --relay        Relayï¼ˆå¯åŠ¨å‰é…ç½®ï¼Œä¸å¯è¿è¡Œæ—¶æ›´æ”¹ï¼‰              â”‚
â”‚    --serve        æœåŠ¡èƒ½åŠ›ï¼ˆBootstrap + Relayï¼‰                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ JoinRealm()
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Realm å±‚é…ç½®ï¼ˆè¿è¡Œæ—¶ï¼‰                                           â”‚
â”‚    /gateway set   Gatewayï¼ˆè¿è¡Œæ—¶å¯é…ç½®ï¼‰                         â”‚
â”‚    /gateway enable  Gateway æœåŠ¡ï¼ˆè¿è¡Œæ—¶å¯å¯ç”¨/ç¦ç”¨ï¼‰              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®åŒºåˆ«**ï¼š
- Node å±‚é…ç½®åœ¨å¯åŠ¨å‰é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æŒ‡å®š
- Realm å±‚é…ç½®å¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡å‘½ä»¤åŠ¨æ€é…ç½®

è¯¦è§ [chat/README.md](chat/README.md)

---

## è¿è¡Œæ—¶æ–‡ä»¶

```
examples/chat/data/
â”œâ”€â”€ node-{pid}/       # èŠ‚ç‚¹æ•°æ®ï¼ˆæŒ‰ PID éš”ç¦»ï¼‰
â”‚   â””â”€â”€ dep2p.db/     # BadgerDB æ•°æ®åº“
â””â”€â”€ logs/             # æ—¥å¿—æ–‡ä»¶
```

æ¸…ç†ï¼š`rm -rf examples/chat/data/`

---

## ç›¸å…³æ–‡æ¡£

- [chat è¯¦ç»†æ–‡æ¡£](chat/README.md)
- [ADR-0009: Bootstrap æç®€é…ç½®](../design/01_context/decisions/ADR-0009-bootstrap-simplified.md)
- [ADR-0010: Relay æ˜ç¡®é…ç½®](../design/01_context/decisions/ADR-0010-relay-explicit-config.md)
- [åŸºç¡€è®¾æ–½èŠ‚ç‚¹éƒ¨ç½²](../cmd/dep2p/deploy/README.md)
- [cmd/dep2p ä½¿ç”¨è¯´æ˜](../cmd/dep2p/README.md)
